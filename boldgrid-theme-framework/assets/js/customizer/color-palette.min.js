var BOLDGRID=BOLDGRID||{};BOLDGRID.COLOR_PALETTE=BOLDGRID.COLOR_PALETTE||{},BOLDGRID.COLOR_PALETTE.Modify=BOLDGRID.COLOR_PALETTE.Modify||{},function(t){"use strict";var e=(t(document),t(window)),o=BOLDGRID.COLOR_PALETTE.Modify,a=o;o.palette_generator=BOLDGRID.COLOR_PALETTE.Generate,o.generated_color_palettes=5,o.state=null,o.active_body_class="",o.first_update=!0;var r=["#232323","#FFFFFF","#FF5F5F","#FFDBB8","#FFFFB2","#bad6b1","#99acbf","#cdb5e2"];t(function(){a.$palette_control_wrapper=t("#customize-control-boldgrid-color-palette"),a.$color_picker_input=a.$palette_control_wrapper.find(".pluto-color-control"),a.$palette_option_field=a.$palette_control_wrapper.find(".palette-option-field"),a.generated_palettes_container=a.$palette_control_wrapper.find(".generated-palettes-container"),a.$accoridon_section_colors=t("#accordion-section-colors"),a.$neutral_color_selection=a.$palette_control_wrapper.find(".boldgrid-neutral-color"),o.duplicate_modification_icons(),o.bind_palette_duplicate_remove(),o.bind_palette_activation(),o.bind_color_activation(),o.setup_color_picker(),o.setup_close_color_picker(),o.bind_generate_palette_action(),o.setup_palette_generation(),o.bind_help_section_visibility(),o.bind_help_link(),o.setup_advanced_options(),o.bind_compile_done(),o.fetch_acceptable_palette_formats(),setTimeout(o.wp_picker_post_init,100),o.set_neutral_color_text()}),o.bind_help_section_visibility=function(){t(".accordion-section").on("click",function(){var e=t(".boldgrid-color-palette-help");a.$accoridon_section_colors.hasClass("open")&&!e.is(":visible")?e.show():!1===a.$accoridon_section_colors.hasClass("open")&&e.hide()})},o.setup_close_color_picker=function(){a.$close_palette_creator=t("<button type='button' class='button close-color-picker'>Done</button>"),t(".boldgrid-color-palette-wrapper input[type=text].wp-color-picker").after(a.$close_palette_creator),a.$close_palette_creator.on("click",function(){t("body").click()})},o.setup_palette_generation=function(){a.$magic_button=t(".palette-generator-button"),a.$magic_button.on("click",function(t){a.$magic_button.closest(".boldgrid-color-palette-wrapper").addClass("palette-generate-mode")}),a.$palette_control_wrapper.on("click",".palette-generate-mode .current-palette-wrapper .color-lock",function(e){e.stopPropagation();var o=t(this);a.$palette_control_wrapper.find(".boldgrid-active-palette li").eq(o.data("count")).toggleClass("selected-for-generation"),o.toggleClass("selected-for-generation")}),a.$palette_control_wrapper.find(".cancel-generated-palettes-button").on("click",function(e){e.stopPropagation();var o=t(this);a.$palette_control_wrapper.find(".boldgrid-active-palette[data-auto-generated]").removeAttr("data-auto-generated"),a.generated_palettes_container.empty(),o.closest(".palette-generate-mode").removeClass("palette-generate-mode").find(".selected-for-generation").removeClass("selected-for-generation")})},o.duplicate_modification_icons=function(){o.$icon_set=a.$palette_control_wrapper.find(".boldgrid-duplicate-dashicons").first(),o.$icon_set&&(o.$icon_set=o.$icon_set.clone())},o.setup_advanced_options=function(){a.$palette_control_wrapper.find(".boldgrid-advanced-options-content").hide(),a.$palette_control_wrapper.find(".boldgrid-advanced-options").on("click",function(t){t.stopPropagation()}),a.$palette_control_wrapper.find(".boldgrid-advanced-options-label").on("click",function(e){e.stopPropagation(),t(this).closest(".boldgrid-advanced-options").find(".boldgrid-advanced-options-content").stop().slideToggle()})},o.bind_generate_palette_action=function(){a.$palette_control_wrapper.find(".palette-generator-button").on("click",function(t){var e=o.create_partial_palette(),a=BOLDGRID.COLOR_PALETTE.Generate.generate_palette_collection(e,o.generated_color_palettes);o.display_generated_palettes(a)})},o.display_generated_palettes=function(e){var r=a.generated_palettes_container.empty(),l=jQuery(".boldgrid-active-palette").attr("data-neutral-color");t.each(e,function(){var e=t('<div data-palette-wrapper="true"><ul><li class="boldgrid-palette-colors"></li></ul></div>'),a=e.find("ul").addClass("boldgrid-inactive-palette").attr("data-auto-generated","true").attr("data-neutral-color",l).attr("data-color-palette-format",o.get_random_format()),i=a.find("li");t.each(this,function(){var e=t("<span></span>").css("background-color",this).attr("data-color",!0);i.append(e)}),r.append(e)})},o.create_partial_palette=function(){var e=[];return a.$palette_control_wrapper.find(".boldgrid-active-palette .boldgrid-palette-colors").each(function(){var o=t(this);o.hasClass("selected-for-generation")?e.push(o.css("background-color")):e.push(null)}),e},o.fetch_acceptable_palette_formats=function(){o.body_classes=a.$palette_control_wrapper.find(".boldgrid-color-palette-wrapper").data("color-formats"),"object"==typeof o.body_classes&&(o.body_classes=t.map(o.body_classes,function(t,e){return[t]}))},o.revert_current_selection=function(e){e.removeClass("current-palette-wrapper");var a=e.find("> ul");a.removeClass("boldgrid-active-palette").addClass("boldgrid-inactive-palette"),a.find(".boldgrid-duplicate-dashicons").remove();var r=t('<li class="boldgrid-palette-colors"></li>');a.find(".boldgrid-palette-colors:not(.ui-sortable-helper)").not(".ui-sortable-placeholder").each(function(){var e=t(this);if("absolute"!=e.css("position")){var o=t('<span data-color="true"></span>').css("background-color",e.css("background-color"));r.append(o)}}),e.find(".bg-lock-controls").remove(),r.append(o.$icon_set.clone()),a.find(".boldgrid-palette-colors").remove(),a.append(r),a.data("ui-sortable")&&a.sortable("disable")},o.bind_help_link=function(){a.$palette_control_wrapper.on("click",'[data-action="open-color-picker"]',function(t){t.stopPropagation();var e=a.$palette_control_wrapper.find(".boldgrid-active-palette .boldgrid-palette-colors:first");o.activate_color(null,e)})},o.sync_locks=function(){var e=a.$palette_control_wrapper.find(".bg-lock-controls .color-lock");e.removeClass("selected-for-generation"),a.$palette_control_wrapper.find(".boldgrid-active-palette .boldgrid-palette-colors").each(function(o){var a=t(this);a.hasClass("selected-for-generation")&&e.eq(o).addClass("selected-for-generation")})},o.activate_palette=function(e){a.$palette_control_wrapper.find(".wp-color-result").addClass("expanded-wp-colorpicker"),e.attr("data-auto-generated")&&(e=e.closest("div").clone().find("[data-auto-generated]"));var r=[];a.$palette_control_wrapper.find(".boldgrid-active-palette .boldgrid-palette-colors").each(function(e){var o=t(this);o.hasClass("selected-for-generation")&&r.push(e)}),e.find("span[data-color]").each(function(o){var a=t(this),l=a.css("background-color"),i="";"-1"!=r.indexOf(o)&&(i="selected-for-generation"),e.append('<li class="boldgrid-palette-colors '+i+' boldgrid-dashicon" style="background-color: '+l+'"></li>')}),e.append(o.$icon_set.clone()),e.find("li:first").remove();var l=e.closest("div").addClass("current-palette-wrapper").detach();a.$palette_control_wrapper.find(".boldgrid-color-palette-wrapper").prepend(l);var i=a.$palette_control_wrapper.find(".palette-action-buttons");i.removeClass("hidden").insertAfter(e),o.$color_picker.show(),a.$palette_control_wrapper.find(".boldgrid-active-palette").each(function(){var e=t(this);e.attr("data-auto-generated")?e.closest("div").remove():o.revert_current_selection(e.closest("div"))}),o.add_jquery_sortable(e),a.$neutral_color_selection.css("background-color",e.attr("data-neutral-color")),o.set_neutral_color_text(),e.sortable("enable"),e.disableSelection(),e.removeClass("boldgrid-inactive-palette"),e.addClass("boldgrid-active-palette"),e.find("li").disableSelection();var n=t('<div class="bg-lock-controls"></div>');e.find("li").each(function(t){n.append('<div class="color-lock" data-count="'+t+'"><div class="lock unlock"><div class="top"></div><div class="mid"></div><div class="bottom"><div class="keyhole-top"></div><div class="keyhole-bottom"></div></div></div>')}),e.after(n),o.sync_locks(),o.first_update?o.first_update=!1:o.update_theme_option()},o.add_jquery_sortable=function(e){e.sortable({start:function(t,e){if(e.item){var a=e.item;a.find("span").length||o.modify_palette_action(a.closest('[data-palette-wrapper="true"]'))}},helper:"clone",stop:function(e,r){if(o.update_theme_option(),o.open_picker(),r.item){var l=r.item;if(!l.find("span").length){a.$palette_control_wrapper.find(".active-palette-section").removeClass("active-palette-section"),l.addClass("active-palette-section"),l.siblings().each(function(){var e=t(this);e.toggleClass("boldgrid-dashicon"),setTimeout(function(){e.toggleClass("boldgrid-dashicon")},15)});var i=l.closest(".boldgrid-color-palette-wrapper");o.preselect_active_color(i),o.sync_locks()}}}})},o.format_current_palette_state=function(){var e=a.$palette_control_wrapper.find(".boldgrid-active-palette").first(),o={};o["active-palette"]=e.attr("data-color-palette-format"),o["active-palette-id"]=e.attr("data-palette-id"),o.palettes={},o.saved_palettes=[],a.active_body_class=o["active-palette"];var r=function(){var e=t(this),a={};a=e.hasClass("boldgrid-active-palette")?e.find("li.boldgrid-palette-colors"):e.find(".boldgrid-palette-colors span");var r=[];a.not(".dashicons").each(function(){r.push(t(this).css("background-color"))});var l={format:e.attr("data-color-palette-format"),colors:r,"neutral-color":e.attr("data-neutral-color")};o.palettes[e.attr("data-color-palette-format")]=l,e.attr("data-copy-on-mod")||o.saved_palettes.push(l)};return a.$palette_control_wrapper.find("[data-color-palette-format]").not(e).not('[data-auto-generated="true"]').each(r),e.each(r),o},o.create_color_scss_file=function(e){var o="";o+="$palette-primary_1: null;$palette-primary_2: null;$palette-primary_3: null;$palette-primary_4: null;$palette-primary_5: null;$palette-primary-neutral-color: null;$text-contrast-palette-primary-1: null;$text-contrast-palette-primary-2: null;$text-contrast-palette-primary-3: null;$text-contrast-palette-primary-4: null;$text-contrast-palette-primary-5: null;$text-contrast-palette-primary-neutral-color: null;";var a="$colors: ";t.each(e.palettes,function(e){if(this.colors){var r=a;t.each(this.colors,function(t){var a=t+1;o+="$"+e+"_"+a.toString()+":"+this+";",r+="$"+e+"_"+a.toString()+" "}),r!=a&&(o+=r+";")}this["neutral-color"]&&(o+="$"+e+"-neutral-color:"+this["neutral-color"]+";")});var r=wp.customize("boldgrid_light_text").get(),l=wp.customize("boldgrid_dark_text").get();return o+="$light-text:"+r+";",o+="$dark-text:"+l+";"},o.update_theme_option=function(){o.state=o.format_current_palette_state();var t=o.create_color_scss_file(o.state);BOLDGRID.Sass.compile(t+BOLDGRIDSass.ScssFormatFileContents)},o.bind_palette_activation=function(){a.$palette_control_wrapper.on("click",".boldgrid-inactive-palette",function(){o.activate_palette(t(this))})},o.activate_color=function(e,l){var i;e?(i=t(this),e.stopPropagation()):i=l,!1===i.hasClass("active-palette-section")&&(i.hasClass("boldgrid-neutral-color")?a.$color_picker_input.iris({palettes:r}):a.$color_picker_input.iris({palettes:!0}),o.modify_palette_action(i.closest('[data-palette-wrapper="true"]')),a.$palette_control_wrapper.find(".active-palette-section").removeClass("active-palette-section"),i.addClass("active-palette-section"),o.open_picker(),o.set_iris_color(i.css("background-color")))},o.bind_color_activation=function(){a.$palette_control_wrapper.on("click",".boldgrid-active-palette li, .boldgrid-neutral-color",o.activate_color)},o.open_picker=function(){a.$palette_control_wrapper.find(".wp-picker-open").length||a.$palette_control_wrapper.find(".wp-color-result").click()},o.set_iris_color=function(t){var e=net.brehaut.Color(t);a.$color_picker_input.iris("color",e.toString())},o.set_neutral_color_text=function(){var t=net.brehaut.Color(a.$neutral_color_selection.css("background-color"));t.getLuminance()>.5?a.$neutral_color_selection.css("color","#333"):a.$neutral_color_selection.css("color","white")},o.setup_color_picker=function(){var e={defaultColor:!1,change:function(e,r){var l=r.color.toString(),i=a.$palette_control_wrapper.find(".active-palette-section");if(i.css("background-color",l),i.hasClass("boldgrid-neutral-color")){var n=a.$palette_control_wrapper.find(".boldgrid-active-palette");n.attr("data-neutral-color")&&(n.attr("data-neutral-color",l),a.$palette_control_wrapper.find(".generated-palettes-container .boldgrid-inactive-palette").each(function(){t(this).attr("data-neutral-color",l)})),o.set_neutral_color_text()}o.last_refresh_time=(new Date).getTime();var c=o.last_refresh_time;setTimeout(function(){!BOLDGRID.Sass.processing&&(c==o.last_refresh_time||a.most_recent_update+100<(new Date).getTime())&&(o.update_theme_option(),a.most_recent_update=(new Date).getTime())},200,c)},hide:!0,palettes:!0};a.$color_picker_input.wpColorPicker(e);o.$color_picker=a.$palette_control_wrapper.find(".wp-picker-container").hide()},o.preselect_active_color=function(t){o.set_iris_color(t.find(".active-palette-section").css("background-color"))},o.bind_palette_duplicate_remove=function(){a.$palette_control_wrapper.on("click",".boldgrid-copy-palette, .boldgrid-remove-palette",function(e){e.stopPropagation();var a=t(this),r=a.closest('[data-palette-wrapper="true"]'),l=!0;a.hasClass("boldgrid-copy-palette")&&(l=!1),l?o.remove_palette(r):o.copy_palette(r)})},o.remove_palette=function(t){t.find(".boldgrid-inactive-palette").length&&(t.remove(),o.state=o.format_current_palette_state(),o.update_palette_settings(!0))},o.modify_palette_action=function(t){t.find('[data-copy-on-mod="1"]').length&&o.copy_palette(t)},o.copy_palette=function(t){var e=t.find(".boldgrid-active-palette");if(e.length){var a=t.clone(!1);a.find(".palette-action-buttons").remove(),a.find(".boldgrid-active-palette").removeAttr("data-auto-generated"),o.clean_palette_clone(t.find(".boldgrid-active-palette")),o.revert_current_selection(a);var r=o.get_first_inactive();a.insertBefore(r)}else if(t.find(".boldgrid-inactive-palette").length){var l=t.clone(!1);o.clean_palette_clone(l.find(".boldgrid-inactive-palette")),t.after(l)}o.state=o.format_current_palette_state(),o.update_palette_settings(!0)},o.clean_palette_clone=function(t){t.removeAttr("data-copy-on-mod").removeAttr("data-palette-id")},o.get_first_inactive=function(){return a.$palette_control_wrapper.find('.boldgrid-color-palette-wrapper > [data-palette-wrapper="true"]').not(".current-palette-wrapper").first()},o.bind_compile_done=function(){e.on("boldgrid_sass_compile_done",function(t,e){o.compiled_css=e.text,o.update_palette_settings(!0)})},o.update_palette_settings=function(t){o.text_area_val=JSON.stringify({state:o.state}),a.$palette_option_field.val(o.text_area_val),t&&a.$palette_option_field.change()},o.get_random_format=function(){return o.body_classes[0]},o.wp_picker_post_init=function(){var e=a.$palette_control_wrapper.find('.boldgrid-inactive-palette[data-is-active="1"]'),r=a.$palette_control_wrapper.find('.boldgrid-inactive-palette[data-is-default="1"]'),l=r;e.length&&(l=e),l.click(),a.$palette_control_wrapper.find(".wp-color-result").addClass("expanded-wp-colorpicker"),t("body").on("click",function(){a.$palette_control_wrapper.find(".wp-color-result").addClass("expanded-wp-colorpicker"),a.$palette_control_wrapper.find(".boldgrid-color-palette-wrapper").find(".boldgrid-advanced-options").addClass("hidden"),a.$palette_control_wrapper.find(".active-palette-section").removeClass("active-palette-section")}),a.$palette_control_wrapper.find(".wp-color-result").on("click",function(){var e=t(this),r=e.parent().find(".iris-picker").is(":visible");if(r){var l=e.closest(".boldgrid-color-palette-wrapper");e.removeClass("expanded-wp-colorpicker"),a.$palette_control_wrapper.find(".active-palette-section").length||a.$palette_control_wrapper.find(".boldgrid-active-palette li:first").click(),l.find(".boldgrid-advanced-options").removeClass("hidden"),o.preselect_active_color(l)}else e.closest(".boldgrid-color-palette-wrapper").find(".boldgrid-advanced-options").addClass("hidden"),e.addClass("expanded-wp-colorpicker")}),a.active_body_class=a.$palette_control_wrapper.find(".boldgrid-active-palette").first().attr("data-color-palette-format")}}(jQuery);