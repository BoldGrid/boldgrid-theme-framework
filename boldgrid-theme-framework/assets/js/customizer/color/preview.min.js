import PaletteSelector from"./palette-selector";import{Preview as PreviewUtility}from"../preview";const $=jQuery;export class Preview{constructor(){this.previewUtility=new PreviewUtility,this.classControls=[{name:"bgtfw_header_links",selector:"#navi-wrap",properties:["link-color"]},{name:"bgtfw_footer_color",selector:"#colophon, .footer-content",properties:["background-color","text-default"]},{name:"bgtfw_tagline_color",selector:".site-description",properties:["color"]},{name:"bgtfw_site_title_color",selector:".site-title",properties:["color"]},{name:"bgtfw_footer_links",selector:".footer-content",properties:["link-color"]}]}init(){return $(()=>this._onLoad()),this}outputColor(e,t,o){let r,i=$(t),n=new RegExp("color-?([\\d]|neutral)-("+o.join("|")+")(\\s+|$)","g");(e=parent.wp.customize(e)())&&"none"!==e||(e=""),i.removeClass((e,t)=>(t.match(n)||[]).join(" ")),r=(new PaletteSelector).getColorNumber(e),i.addClass(_.map(o,e=>{let t=r;return-1===r.indexOf("neutral")&&-1===e.indexOf("link-color")&&(t=r.replace("-","")),t+"-"+e}).join(" "))}getHeadingCSS(e){const t=(new PaletteSelector).getColor(e);let o="",r=[];return t&&(o=`\n\t\t\t\t${r=this.getHeadingColorSelectors().join(", ")} {\n\t\t\t\t\tcolor: ${t};\n\t\t\t\t}\n\t\t\t`),o}getHeadingColorSelectors(){const e=[];return _.each(_typographyOptions,function(t,o){"headings"===t.type&&e.push(o)}),e}setHeadingColors(){const e=this.getHeadingCSS(wp.customize("bgtfw_headings_color")());this.previewUtility.updateDynamicStyles("bgtfw_headings_color",e)}_onLoad(){this.setHeadingColors(),this._bindConfiguredControls(),this._bindHeadingColor()}_bindConfiguredControls(){for(const e of this.classControls)wp.customize(e.name,t=>{t.bind(()=>this.outputColor(e.name,e.selector,e.properties))})}_bindHeadingColor(){wp.customize("bgtfw_headings_color",e=>{e.bind(()=>this.setHeadingColors())})}};export default Preview;