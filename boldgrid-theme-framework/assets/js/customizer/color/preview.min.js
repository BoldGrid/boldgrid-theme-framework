import PaletteSelector from"./palette-selector";const $=jQuery;export class Preview{constructor(){this.classControls=[{name:"bgtfw_header_links",selector:"#navi-wrap",properties:["link-color"]},{name:"bgtfw_footer_color",selector:"#colophon, .footer-content",properties:["background-color","text-default"]},{name:"bgtfw_tagline_color",selector:".site-description",properties:["color"]},{name:"bgtfw_site_title_color",selector:".site-title",properties:["color"]},{name:"bgtfw_footer_links",selector:".footer-content",properties:["link-color"]}]}init(){return $(()=>this._onLoad()),this}outputColor(t,e,o){let r,n=$(e),l=new RegExp("color-?([\\d]|neutral)-("+o.join("|")+")(\\s+|$)","g");(t=parent.wp.customize(t)())&&"none"!==t||(t=""),n.removeClass((t,e)=>(e.match(l)||[]).join(" ")),r=(new PaletteSelector).getColorNumber(t),n.addClass(_.map(o,t=>{let e=r;return-1===r.indexOf("neutral")&&-1===t.indexOf("link-color")&&(e=r.replace("-","")),e+"-"+t}).join(" "))}getHeadingCSS(t){const e=(new PaletteSelector).getColor(t);let o="";return e&&(o=`\n\t\t\t\t.palette-primary h1,\n\t\t\t\t.palette-primary h2,\n\t\t\t\t.palette-primary h3,\n\t\t\t\t.palette-primary h4,\n\t\t\t\t.palette-primary h5,\n\t\t\t\t.palette-primary h6\n\t\t\t\t{\n\t\t\t\t\tcolor: ${e};\n\t\t\t\t}\n\t\t\t`),o}updateDynamicStyles(t,e){const o=$("head");let r=o.find("#"+t);return r.length?r.html(e):((r=$('<style type="text/css" id="'+t+'">')).html(e),o.append(r)),r}_onLoad(){this._bindConfiguredControls(),this._bindHeadingColor()}_bindConfiguredControls(){for(const t of this.classControls)wp.customize(t.name,e=>{e.bind(()=>this.outputColor(t.name,t.selector,t.properties))})}_bindHeadingColor(){wp.customize("bgtfw_headings_color",t=>{t.bind(t=>{const e=this.getHeadingCSS(t);this.updateDynamicStyles("bgtfw_headings_color",e)})})}};export default Preview;