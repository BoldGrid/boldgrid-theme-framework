import PaletteSelector from"./palette-selector";import{Preview as PreviewUtility}from"../preview";const $=jQuery;export class Preview{constructor(){this.previewUtility=new PreviewUtility,this.classControls=[{name:"bgtfw_header_links",selector:"#navi-wrap",properties:["link-color"]},{name:"bgtfw_footer_color",selector:"#colophon, .footer-content",properties:["background-color","text-default"]},{name:"bgtfw_tagline_color",selector:".site-description",properties:["color"]},{name:"bgtfw_site_title_color",selector:".site-title",properties:["color"]},{name:"bgtfw_footer_links",selector:".footer-content",properties:["link-color"]}]}init(){return $(()=>this._onLoad()),this}outputColor(e,t,o){let r,n=$(t),i=new RegExp("color-?([\\d]|neutral)-("+o.join("|")+")(\\s+|$)","g");(e=parent.wp.customize(e)())&&"none"!==e||(e=""),n.removeClass((e,t)=>(t.match(i)||[]).join(" ")),r=(new PaletteSelector).getColorNumber(e),n.addClass(_.map(o,e=>{let t=r;return-1===r.indexOf("neutral")&&-1===e.indexOf("link-color")&&(t=r.replace("-","")),t+"-"+e}).join(" "))}getHeadingCSS(e){const t=(new PaletteSelector).getColor(e);let o="",r=[];return t&&(o=`\n\t\t\t\t${r=this.getHeadingColorSelectors().join(", ")} {\n\t\t\t\t\tcolor: ${t};\n\t\t\t\t}\n\t\t\t`),o}getHeadingColorSelectors(){const e=[];return _.each(window._typographyOptions,function(t,o){"headings"===t.type&&e.push(o)}),e}setHeadingColors(){const e=this.getHeadingCSS(wp.customize("bgtfw_headings_color")());this.previewUtility.updateDynamicStyles("bgtfw_headings_color",e)}getHamburgerCSS(e,t){return`\n\t\t.${t}-btn .hamburger-inner,\n\t\t.${t}-btn .hamburger-inner::before,\n\t\t.${t}-btn .hamburger-inner::after {\n\t\t\tbackground-color: ${(new PaletteSelector).getColor(e)};\n\t\t}`}setHamburgerColors(e,t){let o=wp.customize(`bgtfw_menu_hamburger_${e}_color`)(),r=this.getHamburgerCSS(o,t);this.previewUtility.updateDynamicStyles(`bgtfw_menu_hamburger_${e}_color`,r)}setHeaderOverlay(){const e=(new PaletteSelector).getColor(wp.customize("bgtfw_header_overlay_color")()),t=wp.customize("bgtfw_header_overlay_alpha")(),o=parent.net.brehaut.Color(e).setAlpha(t).toString();let r="#wp-custom-header::after{ display: none; }";wp.customize("bgtfw_header_overlay")()&&(r=`\n\t\t\t\t#wp-custom-header::after {\n\t\t\t\t\tbackground-color: ${o} !important;\n\t\t\t\t}\n\t\t\t`),this.previewUtility.updateDynamicStyles("bgtfw-header-overlay-inline-css",r)}hamburgers(){const e=window._wpCustomizePreviewNavMenusExports.navMenuInstanceArgs;for(const t in e){const o=e[t];this.setHamburgerColors(o.theme_location,o.menu_id),this._bindHamburgerColors(o.theme_location,o.menu_id)}}_onLoad(){this.setHeadingColors(),this.hamburgers(),this._bindConfiguredControls(),this._bindHeadingColor(),this._bindHeaderOverlay()}_bindHeaderOverlay(){wp.customize("bgtfw_header_overlay_alpha","bgtfw_header_overlay","bgtfw_header_overlay_color",(...e)=>{e.map(e=>e.bind(()=>this.setHeaderOverlay()))})}_bindConfiguredControls(){for(const e of this.classControls)wp.customize(e.name,t=>{t.bind(()=>this.outputColor(e.name,e.selector,e.properties))})}_bindHeadingColor(){wp.customize("bgtfw_headings_color",e=>{e.bind(()=>this.setHeadingColors())})}_bindHamburgerColors(e,t){wp.customize(`bgtfw_menu_hamburger_${e}_color`,o=>{o.bind(()=>this.setHamburgerColors(e,t))})}};export default Preview;