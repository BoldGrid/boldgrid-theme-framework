import ColorPreview from"./color/preview";import{Preview as GenericPreview}from"./generic/preview.js";import{Preview as HeaderPreview}from"./header-layout/preview.js";import{Preview as BackgroundPreview}from"./background/preview.js";import{LinkPreview}from"./typography/link-preview.js";import Toggle from"./toggle/toggle";import ToggleValue from"./toggle/value";import ToggleClass from"./toggle/class";import"./widget-meta";import{Preview as TypographyPreview}from"./typography/preview";const api=wp.customize,controlApi=parent.wp.customize;BOLDGRID.Customizer=BOLDGRID.Customizer||{},BOLDGRID.Customizer.Util=BOLDGRID.Customizer.Util||{},BOLDGRID.Customizer.Widgets=BOLDGRID.Customizer.Widgets||{},BOLDGRID.Customizer.Util.bgtfwIsJSON=function(e){return!(!_.isString(e)||/^\s*$/.test(e))&&(e=(e=(e=e.replace(/\\(?:["\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@")).replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,"]")).replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))},BOLDGRID.Customizer.Util.getAllUrlParams=function(e){let t=e?e.split("?")[1]:window.location.search.slice(1);const i={};if(t){let e=(t=t.split("#")[0]).split("&");for(let t=0;t<e.length;t++){let n=e[t].split("="),o=void 0,r=n[0].replace(/\[\d*\]/,function(e){return o=e.slice(1,-1),""}),a=void 0===n[1]||n[1];r=r.toLowerCase(),a=a.toLowerCase(),i[r]?("string"==typeof i[r]&&(i[r]=[i[r]]),void 0===o?i[r].push(a):i[r][o]=a):i[r]=a}}return i},BOLDGRID.Customizer.Util.bgtfwParseJSON=function(e){var t;if(BOLDGRID.Customizer.Util.bgtfwIsJSON(e))try{if((t=JSON.parse(e))&&_.isObject(t))return t}catch(e){return!1}return!1},BOLDGRID.Customizer.Util.getInitialPalettes=function(e){var t,i,n;return _.isUndefined(e)&&(e=api("boldgrid_color_palette")()),!(!(t=BOLDGRID.Customizer.Util.bgtfwParseJSON(e))||_.isUndefined(t.state)||_.isUndefined(t.state.palettes)||_.isUndefined(t.state["active-palette"])||(n=t.state["active-palette"],_.isUndefined(t.state.palettes[n])||(n=t.state.palettes[n],_.isUndefined(n.colors)||(i=n.colors,_.isUndefined(n["neutral-color"])||i.push(n["neutral-color"]),!i.length))))&&i},function(e){var t,i,n;t=e("body"),i=e("#boldgrid-override-styles"),n=(new ColorPreview).init();let o=(new BackgroundPreview).init();(new GenericPreview).bindEvents(),(new HeaderPreview).bindEvents(),(new TypographyPreview).bindEvents(),(new LinkPreview).bindEvents(),e(function(){var r,a,s,d,l,c,g,u,p,m,f,b,w;let h=BoldGrid.custom_header.calc;s=function(){e(".post-edit-link").on("click",function(){parent.location=e(this).attr("href")})},d=function(e){"pattern"===e?r():(t.css({"background-image":"","background-size":"","background-repeat":"no-repeat","background-attachment":""}),m()),i.remove()},l=function(e){t.css("background-size",e)},c=function(i){var n;"parallax"===i?(t.addClass("boldgrid-customizer-parallax-effect"),t.css("background-attachment","fixed"),t.css({"background-position":"0px 0px","background-attachment":"fixed"}),t.data("stellar-background-ratio","0.2"),t.stellar(),t.data("plugin_stellar")&&t.data("plugin_stellar").init()):((n=e("body").data("plugin_stellar"))&&n.destroy(),l(api("boldgrid_background_image_size")()),t.css({"background-attachment":i}),g(),u(),p(),t.removeClass("boldgrid-customizer-parallax-effect"))},g=function(){var e,i;e=api("boldgrid_background_vertical_position")(),i=t.css("background-position").split(" ")[0]+" "+5*e+"px",t.css("background-position",i)},u=function(){var e;e=5*api("boldgrid_background_horizontal_position")()+"px "+t.css("background-position").split(" ")[1],t.css("background-position",e)},a=function(t,i){var o=[];_.each(BOLDGRID.CUSTOMIZER.data.customizerOptions.typography.selectors,function(e,t){"headings"===e.type&&o.push(i+" "+t)}),o=o.join(", "),n.outputColor(t,e(o).not(".site-description"),["color"])},r=function(){var e;"pattern"===api("boldgrid_background_type")()&&((e=api("boldgrid_background_pattern")())||(e="none"),i.remove(),t.css({"background-image":e,"background-size":"auto","background-repeat":"repeat","background-attachment":"scroll"}),n.outputColor("boldgrid_background_color","body",["background-color","text-default"]))},p=function(){t.css({"background-repeat":api("background_repeat")()})},m=function(){var t,i,n;e("#custom-background-css").remove(),"pattern"===(n=api("boldgrid_background_type")())&&r(),"pattern"!==n&&(t=api("background_attachment")(),i=api("boldgrid_background_image_size")(),c(t),l(i),o.setImage(),"parallax"!==t&&(g(),u(),p()))},f=function(){var t;api.bind("ready",_.defer(function(){_.isFunction(controlApi.section)&&(t=controlApi.section("boldgrid_footer_panel").controls(),_(t).each(function(t){var i;new RegExp(/^(hide_)+\w*(_attribution)+$/,"m").test(t.id)&&parseInt(api(t.id)())&&(i="."+t.id.replace("hide_","").replace(/_/g,"-")+"-link",e(i).addClass("hidden"))})),b()}))},b=function(){e(".attribution-theme-mods > .link").removeClass("no-separator").filter(":visible").last().addClass("no-separator")},_.isFunction(controlApi.section)&&(w=controlApi.section("boldgrid_footer_panel").controls(),_(w).each(function(t){var i;new RegExp(/^(hide_)+\w*(_attribution)+$/,"m").test(t.id)&&api(t.id,function(n){i="."+t.id.replace(/hide_/,"").replace(/_/g,"-")+"-link",n.bind(function(t){e(i).toggleClass("hidden",t),b()})})})),m(),f(),s(),e(".site-description").addClass(window._typographyClasses),api("external_header_video","header_video",function(...e){e.map(e=>e.bind(()=>api.preview.send("url",window.location.href)))}),api("bgtfw_site_title_typography","bgtfw_tagline_typography",(...e)=>{e.map(e=>{let t=["font-size","line-height","font-family","font-weight"];e.bind(_.throttle(i=>{_.each(t,_.once(t=>e[t]===i[t]||h()))},250))})}),api("boldgrid_color_palette",function(t){t.bind(function(t){var i,n;i=parent.$(".colors-wrapper"),(n=BOLDGRID.Customizer.Util.getInitialPalettes(t))&&_(i).each(function(t){var i=e(t).find("input");_(i).each(function(t,i){var o,r,a;"transparent"!==(o=e(t).val())&&(r=o.substring(0,o.indexOf(":")+1)+n[i],e(t).val(r),e(t).next().find(".color-palette-color").css("background",n[i]).text(n[i]),e(t).is(":checked")&&(a=e(t).data("customize-setting-link"),_.isUndefined(a)||controlApi(a).set(r)))})})})}),api("bgtfw_header_color",function(e){e.bind(function(){n.outputColor("bgtfw_header_color","#masthead, #navi",["background-color","text-default"])})}),new ToggleValue("header_container","#navi, #secondary-menu","container",h),new ToggleValue("bgtfw_blog_page_container",".blog .site-content, .archive .site-content","container",h),new ToggleClass("bgtfw_fixed_header","body","header-fixed",h);let v=(e,t)=>(t.match(/(^|\s)layout-\S+/g)||[]).join(" ");new ToggleValue("bgtfw_footer_layouts","#colophon",v),new ToggleValue("bgtfw_header_top_layouts","#masthead",v,h);let k=(e,t)=>(t.match(/(^|\s)hamburger--\S+/g)||[]).join(" "),C=(e,t)=>(t.match(/(^|\s)hvr-\S+/g)||[]).join(" "),y=t=>{var i;if((i=1===t.length?e(t).children(".current-menu-item"):e(`#${t} > .current-menu-item`)).length&&!i.hasClass("current-menu-parent")){let t=i.find("a"),n=new RegExp("(color-?([\\d]|neutral)|transparent)-.?[^\\s]+","g");_.each(t,t=>{let i=BOLDGRID.Customizer.Util.getAllUrlParams(_wpCustomizeSettings.url.self),o=BOLDGRID.Customizer.Util.getAllUrlParams(e(t).attr("href"));!_.isMatch(o,i)&&e(t).parent("li").removeClass("current-menu-item").removeClass((e,t)=>(t.match(n)||[]).join(" "))})}},z=(e,t)=>{let i=`bgtfw_menu_background_${e}`,n=api(i)().includes("transparent");n&&(i="header",BOLDGRID.CUSTOMIZER.data.menu.footerMenus.includes(e)&&(i="footer"),i=`bgtfw_${i}_color`),(new ColorPreview).outputColor(i,`#${t}`,["background-color"],n)};for(const t of Object.values(_wpCustomizePreviewNavMenusExports.navMenuInstanceArgs))y(t.menu_id),new ToggleValue(`bgtfw_menu_hamburger_${t.theme_location}_toggle`,`#${t.menu_id}`,()=>{let i=`nav_menu_instance[${t.args_hmac}]`;wp.customize.selectiveRefresh.partial(i)&&(e(`#${t.menu_id}`).smartmenus("destroy"),wp.customize.selectiveRefresh.partial(i).refresh())}),new ToggleValue(`bgtfw_menu_hamburger_${t.theme_location}`,`#${t.menu_id}-hamburger`,k),new Toggle(`bgtfw_menu_hamburger_${t.theme_location}_toggle`,i=>{let n=document.getElementById(`${t.menu_id}-state`),o=document.getElementById(`${t.menu_id}-hamburger`);i||n.checked||(e(n).click(),o.classList.remove("is-active")),i&&n.checked&&(e(n).click(),o.classList.remove("is-active")),e(`#${t.menu_id}-hamburger, #${t.menu_id}-state`).toggleClass("hidden",!i)&&h()}),new ToggleValue(`bgtfw_menu_items_hover_effect_${t.theme_location}`,`#${t.menu_id} > li:not(.current-menu-item)`,C),api(`bgtfw_menu_background_${t.theme_location}`,"bgtfw_header_color","bgtfw_footer_color",(...e)=>{e.map(e=>e.bind(()=>z(t.theme_location,t.menu_id)))});new Toggle("bgtfw_header_width",h),new Toggle("bgtfw_footer_headings_color",()=>a("bgtfw_footer_headings_color",".site-footer :not(.bgtfw-widget-row)")),new Toggle("blogname",t=>e(".site-title a").text(t)&&h()),new Toggle("blogdescription",t=>{e(".site-description").text(t).toggleClass("invisible",!t)&&h()}),new Toggle("boldgrid_background_vertical_position",g),new Toggle("boldgrid_background_horizontal_position",u),new Toggle("boldgrid_background_pattern",r),new Toggle("boldgrid_background_color",r),new Toggle("boldgrid_background_type",d),new Toggle("background_attachment",c),new Toggle("background_repeat",p),new Toggle("boldgrid_background_image_size",l);new ToggleValue("bgtfw_header_layout_position","body","header-top header-left header-right",e=>{"header-top"!==e&&parent.kirkiSetSettingValue.set("bgtfw_header_width",api("bgtfw_header_width")()),h()}),e(document).on("customize-preview-menu-refreshed",function(t,i){e.each(i.newContainer.closest("[data-is-parent-column]"),function(){BOLDGRID.Customizer.Widgets.updatePartial(e(this)),"secondary-menu"===i.container_id&&""!==api("bgtfw_header_container")()&&document.getElementById(i.container_id).classList.add(api("bgtfw_header_container")())})}),api.selectiveRefresh.bind("partial-content-rendered",function(e){"boldgrid_header_widgets"!==e.partial.id&&"boldgrid_footer_widgets"!==e.partial.id||BOLDGRID.Customizer.Widgets.updatePartial(e.container),h()}),BOLDGRID.Customizer.Widgets.updatePartial=function(e){e.find(".comment-reply-link").addClass("btn button-primary color1-text-contrast").css("transition","all .5s"),e.find(".widget_rss ul").addClass("media-list"),e.find(".widget_meta ul, .widget_recent_entries ul, .widget_archive ul, .widget_categories ul, .widget_nav_menu ul, .widget_pages ul").addClass("nav"),e.find(".widget_recent_comments ul#recentcomments").css({"list-style":"none","padding-left":"0"}),e.find(".widget_recent_comments ul#recentcomments li").css("padding","5px 15px"),e.find('.sidebar select, select[name="archive-dropdown"]').addClass("form-control"),e.find(".sidebar .button").removeClass("button").addClass("btn button-primary"),e.find(".woocommerce.widget .ui-slider").css("display","none"),e.find(".woocommerce.widget .ui-slider").css("display","block"),e.find(".woocommerce.widget .ui-slider").addClass("color1-background-color").children().addClass("color2-background-color"),e.find(".button").removeClass("button").addClass("btn button-primary"),e.find(".button.alt").removeClass("button alt").addClass("btn button-secondary")},api.selectiveRefresh.bind("render-partials-response",function(t){_.isUndefined(t.nav_menu_instance_args)||_.each(t.nav_menu_instance_args,t=>e(`#${t.menu_id}`).smartmenus("destroy"))}),e(document).on("customize-preview-menu-refreshed",function(e,t){_.isUndefined(BoldGrid)||_.isUndefined(BoldGrid.standard_menu_enabled)||(_.delay(()=>y(t.newContainer),_wpCustomizeSettings.timeouts.selectiveRefresh),BoldGrid.standard_menu_enabled.init(t.newContainer))})})}(jQuery);