var BOLDGRID=BOLDGRID||{};BOLDGRID.Customizer=BOLDGRID.Customizer||{},BOLDGRID.Customizer.Util=BOLDGRID.Customizer.Util||{},BOLDGRID.Customizer.Util.bgtfwIsJSON=function(t){return!(!_.isString(t)||/^\s*$/.test(t))&&(t=t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),t=t.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),t=t.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(t))},BOLDGRID.Customizer.Util.bgtfwParseJSON=function(t){if(BOLDGRID.Customizer.Util.bgtfwIsJSON(t))try{var e=JSON.parse(t);if(e&&_.isObject(e))return e}catch(i){return!1}return!1},BOLDGRID.Customizer.Util.getInitialPalettes=function(t){var e,i,o;return _.isUndefined(t)&&(t=wp.customize("boldgrid_color_palette")()),e=BOLDGRID.Customizer.Util.bgtfwParseJSON(t),!(!e||_.isUndefined(e.state)||_.isUndefined(e.state.palettes)||_.isUndefined(e.state["active-palette"])||(o=e.state["active-palette"],_.isUndefined(e.state.palettes[o])||(o=e.state.palettes[o],_.isUndefined(o.colors)||(i=o.colors,_.isUndefined(o["neutral-color"])||i.push(o["neutral-color"]),!i.length))))&&i},function(t){var e,i;e=t("body"),i=t("#boldgrid-override-styles"),t(function(){g(),b(),n(),t(".site-description").addClass(_typographyClasses),t(document).on("customize-preview-menu-refreshed",function(t,e){_.isUndefined(BoldGrid)||"main"===e.wpNavMenuArgs.theme_location&&(_.isUndefined(BoldGrid.standard_menu_enabled)||BoldGrid.standard_menu_enabled.init(e.newContainer))})}),wp.customize("blogname",function(e){parent.wp.customize("boldgrid_logo_setting")&&!parent.wp.customize("boldgrid_logo_setting").get()&&e.bind(function(e){t(".site-title a").text(e)})}),t.each(["external_header_video","header_video"],function(t,e){wp.customize(e,function(t){t.bind(function(){wp.customize.preview.send("url",window.location.href)})})}),t.each(["bgtfw_site_title_typography","bgtfw_tagline_typography"],function(e,i){wp.customize(i,function(e){e.bind(function(i){t.each(["font-size","line-height","font-family","font-weight"],function(t,n){e[n]!==i[n]&&o()})})})}),wp.customize("blogdescription",function(e){e.bind(function(e){e?t(".site-description").text(e).removeClass("invisible"):t(".site-description").text("").addClass("invisible")})});var o=function(){wp.customize("bgtfw_fixed_header")?BoldGrid.header_fixed.calc():BoldGrid.custom_header.calc(),t(window).trigger("resize")};wp.customize("bgtfw_header_layout_position",function(e){e.bind(function(e){var i;t("body").removeClass("header-top header-left header-right").addClass(e),"header-left"!==e&&"header-right"!==e||(i=wp.customize("bgtfw_header_width")(),parent.kirkiSetSettingValue.set("bgtfw_header_width",i)),o()})}),wp.customize("bgtfw_fixed_header",function(e){e.bind(function(e){var i=t("body");e?i.addClass("header-fixed"):i.removeClass("header-fixed"),o()})}),wp.customize("bgtfw_header_top_layouts",function(e){e.bind(function(e){t("#masthead").removeClass(function(t,e){return(e.match(/(^|\s)layout-\S+/g)||[]).join(" ")}).addClass(e),o()})}),wp.customize("bgtfw_header_width",function(t){t.bind(function(){o()})}),wp.customize("bgtfw_footer_layouts",function(e){e.bind(function(e){t("#colophon").removeClass(function(t,e){return(e.match(/(^|\s)layout-\S+/g)||[]).join(" ")}).addClass(e)})}),wp.customize("boldgrid_color_palette",function(e){e.bind(function(e){var i,o;i=parent.$(".colors-wrapper"),o=BOLDGRID.Customizer.Util.getInitialPalettes(e),o&&_(i).each(function(e){var i=t(e).find("input");_(i).each(function(e,i){var n,a;n=t(e).val(),a=n.substring(0,n.indexOf(":")+1)+o[i],t(e).val(a),t(e).next().find(".color-palette-color").css("background",o[i]).text(o[i]),t(e).is(":checked")&&parent.wp.customize("boldgrid_background_color").set(a)})})})}),wp.customize("custom_theme_css",function(e){e.bind(function(e){t("#boldgrid-custom-css").html(e)})}),wp.customize("boldgrid_background_vertical_position",function(t){t.bind(d)}),wp.customize("boldgrid_background_horizontal_position",function(t){t.bind(s)}),wp.customize("boldgrid_background_pattern",function(t){t.bind(l)}),wp.customize("boldgrid_background_color",function(t){t.bind(l)}),wp.customize("bgtfw_header_color",function(t){t.bind(function(){u("bgtfw_header_color","#masthead")})}),wp.customize("bgtfw_footer_color",function(t){t.bind(function(){u("bgtfw_footer_color","#colophon")})}),wp.customize("boldgrid_background_type",function(t){t.bind(a)}),wp.customize("background_attachment",function(t){t.bind(c)}),wp.customize("background_image",function(t){t.bind(p)}),wp.customize("background_repeat",function(t){t.bind(f)}),wp.customize("boldgrid_background_image_size",function(t){t.bind(r)});var n=function(){t(".post-edit-link").on("click",function(){parent.location=t(this).attr("href")})},a=function(t){"pattern"===t?l():(e.css({"background-image":"","background-size":"","background-repeat":"","background-attachment":""}),g()),i.remove()},r=function(t){e.css("background-size",t)},c=function(i){if("parallax"===i)e.addClass("boldgrid-customizer-parallax-effect"),e.css("background-attachment","fixed"),e.css({"background-position":"0px 0px","background-attachment":"fixed"}),e.data("stellar-background-ratio","0.2"),e.stellar(),e.data("plugin_stellar")&&e.data("plugin_stellar").init();else{var o=t("body").data("plugin_stellar");o&&o.destroy(),r(wp.customize("boldgrid_background_image_size")()),e.css({"background-attachment":i}),d(),s(),f(),e.removeClass("boldgrid-customizer-parallax-effect")}},d=function(){var t=wp.customize("boldgrid_background_vertical_position")(),i=e.css("background-position"),o=i.split(" ")[0]+" "+5*t+"px";e.css("background-position",o)},s=function(){var t=wp.customize("boldgrid_background_horizontal_position")(),i=e.css("background-position"),o=5*t+"px "+i.split(" ")[1];e.css("background-position",o)},u=function(e,i){var o;e=parent.wp.customize(e)(),e&&"none"!==e||(e=""),o=e.split(":").shift(),t(i).removeClass(function(t,e){return(e.match(/(^|\s)color-?([\d]|neutral)\-(background|text)\S+/g)||[]).join(" ")}),~o.indexOf("neutral")||(o=o.replace("-","")),t(i).addClass(o+"-background-color "+o+"-text-default")},l=function(){var t;t=wp.customize("boldgrid_background_pattern")(),t||(t="none"),i.remove(),e.css({"background-image":t,"background-size":"auto","background-repeat":"repeat","background-attachment":"scroll"}),u("boldgrid_background_color","body")},p=function(t){t=t?"url("+t+")":"",e.css({"background-image":t})},f=function(){e.css({"background-repeat":wp.customize("background_repeat")()})},g=function(){t("#custom-background-css").remove();var e=wp.customize("background_attachment")(),i=wp.customize("boldgrid_background_image_size")(),o=wp.customize("boldgrid_background_type")();if(l(),"pattern"!==o){c(e),r(i);var n=wp.customize("background_image")();p(n),"parallax"!==e&&(d(),s(),f())}},b=function(){var e;wp.customize.bind("ready",_.defer(function(){_.isFunction(parent.wp.customize.section)&&(e=parent.wp.customize.section("boldgrid_footer_panel").controls(),_(e).each(function(e){var i,o=new RegExp(/^(hide_)+\w*(_attribution)+$/,"m");o.test(e.id)&&parseInt(wp.customize(e.id)())&&(i="."+e.id.replace("hide_","").replace(/_/g,"-")+"-link",t(i).addClass("hidden"))})),m()}))},m=function(){t(".attribution-theme-mods > .link").removeClass("no-separator").filter(":visible").last().addClass("no-separator")};if(_.isFunction(parent.wp.customize.section)){var w=parent.wp.customize.section("boldgrid_footer_panel").controls();_(w).each(function(e){var i,o=new RegExp(/^(hide_)+\w*(_attribution)+$/,"m");o.test(e.id)&&wp.customize(e.id,function(o){i="."+e.id.replace(/hide_/,"").replace(/_/g,"-")+"-link",o.bind(function(e){e?t(i).addClass("hidden"):t(i).removeClass("hidden"),m()})})})}}(jQuery);