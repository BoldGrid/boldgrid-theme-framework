import ColorPreview from"./color/preview";import{Preview as GenericPreview}from"./generic/preview.js";import Toggle from"./toggle/toggle";import ToggleValue from"./toggle/value";import ToggleClass from"./toggle/class";const api=wp.customize,controlApi=parent.wp.customize;var BOLDGRID=BOLDGRID||{};BOLDGRID.Customizer=BOLDGRID.Customizer||{},BOLDGRID.Customizer.Util=BOLDGRID.Customizer.Util||{},BOLDGRID.Customizer.Widgets=BOLDGRID.Customizer.Widgets||{},BOLDGRID.Customizer.Util.bgtfwIsJSON=function(e){return!(!_.isString(e)||/^\s*$/.test(e))&&(e=(e=(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@")).replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]")).replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))},BOLDGRID.Customizer.Util.bgtfwParseJSON=function(e){var t;if(BOLDGRID.Customizer.Util.bgtfwIsJSON(e))try{if((t=JSON.parse(e))&&_.isObject(t))return t}catch(e){return!1}return!1},BOLDGRID.Customizer.Util.getInitialPalettes=function(e){var t,o,n;return _.isUndefined(e)&&(e=api("boldgrid_color_palette")()),!(!(t=BOLDGRID.Customizer.Util.bgtfwParseJSON(e))||_.isUndefined(t.state)||_.isUndefined(t.state.palettes)||_.isUndefined(t.state["active-palette"])||(n=t.state["active-palette"],_.isUndefined(t.state.palettes[n])||(n=t.state.palettes[n],_.isUndefined(n.colors)||(o=n.colors,_.isUndefined(n["neutral-color"])||o.push(n["neutral-color"]),!o.length))))&&o},function(e){var t,o,n;t=e("body"),o=e("#boldgrid-override-styles"),n=(new ColorPreview).init(),(new GenericPreview).bindEvents(),e(function(){var i,a,r,d,l,s,c,g,u,p,b,m,f,h;let w=BoldGrid.custom_header.calc;r=function(){e(".post-edit-link").on("click",function(){parent.location=e(this).attr("href")})},d=function(e){"pattern"===e?i():(t.css({"background-image":"","background-size":"","background-repeat":"no-repeat","background-attachment":""}),b()),o.remove()},l=function(e){t.css("background-size",e)},s=function(o){var n;"parallax"===o?(t.addClass("boldgrid-customizer-parallax-effect"),t.css("background-attachment","fixed"),t.css({"background-position":"0px 0px","background-attachment":"fixed"}),t.data("stellar-background-ratio","0.2"),t.stellar(),t.data("plugin_stellar")&&t.data("plugin_stellar").init()):((n=e("body").data("plugin_stellar"))&&n.destroy(),l(api("boldgrid_background_image_size")()),t.css({"background-attachment":o}),c(),g(),p(),t.removeClass("boldgrid-customizer-parallax-effect"))},c=function(){var e,o;e=api("boldgrid_background_vertical_position")(),o=t.css("background-position").split(" ")[0]+" "+5*e+"px",t.css("background-position",o)},g=function(){var e;e=5*api("boldgrid_background_horizontal_position")()+"px "+t.css("background-position").split(" ")[1],t.css("background-position",e)},a=function(t,o){var i=[];_.each(_typographyOptions,function(e,t){"headings"===e.type&&i.push(o+" "+t)}),i=i.join(", "),n.outputColor(t,e(i).not(".site-description"),["color"])},i=function(){var e;(e=api("boldgrid_background_pattern")())||(e="none"),o.remove(),t.css({"background-image":e,"background-size":"auto","background-repeat":"repeat","background-attachment":"scroll"}),n.outputColor("boldgrid_background_color","body",["background-color","text-default"])},u=function(e){e=e?"url("+e+")":"",t.css({"background-image":e})},p=function(){t.css({"background-repeat":api("background_repeat")()})},b=function(){var t,o,n,a;e("#custom-background-css").remove(),"pattern"===(n=api("boldgrid_background_type")())&&i(),"pattern"!==n&&(t=api("background_attachment")(),o=api("boldgrid_background_image_size")(),s(t),l(o),a=api("background_image")(),u(a),"parallax"!==t&&(c(),g(),p()))},m=function(){var t;api.bind("ready",_.defer(function(){_.isFunction(controlApi.section)&&(t=controlApi.section("boldgrid_footer_panel").controls(),_(t).each(function(t){var o;new RegExp(/^(hide_)+\w*(_attribution)+$/,"m").test(t.id)&&parseInt(api(t.id)())&&(o="."+t.id.replace("hide_","").replace(/_/g,"-")+"-link",e(o).addClass("hidden"))})),f()}))},f=function(){e(".attribution-theme-mods > .link").removeClass("no-separator").filter(":visible").last().addClass("no-separator")},_.isFunction(controlApi.section)&&(h=controlApi.section("boldgrid_footer_panel").controls(),_(h).each(function(t){var o;new RegExp(/^(hide_)+\w*(_attribution)+$/,"m").test(t.id)&&api(t.id,function(n){o="."+t.id.replace(/hide_/,"").replace(/_/g,"-")+"-link",n.bind(function(t){e(o).toggleClass("hidden",t),f()})})})),b(),m(),r(),e(".site-description").addClass(_typographyClasses),api("external_header_video","header_video",function(...e){e.map(e=>e.bind(()=>api.preview.send("url",window.location.href)))}),api("bgtfw_site_title_typography","bgtfw_tagline_typography",(...e)=>{e.map(e=>{let t=["font-size","line-height","font-family","font-weight"];e.bind(_.throttle(o=>{_.each(t,_.once(t=>e[t]===o[t]||w()))},250))})}),api("boldgrid_color_palette",function(t){t.bind(function(t){var o,n;o=parent.$(".colors-wrapper"),(n=BOLDGRID.Customizer.Util.getInitialPalettes(t))&&_(o).each(function(t){var o=e(t).find("input");_(o).each(function(t,o){var i,a,r;a=(i=e(t).val()).substring(0,i.indexOf(":")+1)+n[o],e(t).val(a),e(t).next().find(".color-palette-color").css("background",n[o]).text(n[o]),e(t).is(":checked")&&(r=e(t).data("customize-setting-link"),_.isUndefined(r)||controlApi(r).set(a))})})})}),api("bgtfw_header_color",function(e){e.bind(function(e){var t,o,i,a,r;n.outputColor("bgtfw_header_color","#masthead, #navi",["background-color","text-default"]),a=e.split(":").pop(),i=".header-left #main-menu, .header-right #main-menu { background-color: "+(r=parent.net.brehaut.Color(a)).setAlpha(.7).toString()+"; }",i+="@media (min-width: 768px) {",i+=".sm-clean ul, .sm-clean ul a, .sm-clean ul a:hover, .sm-clean ul a:focus, .sm-clean ul a:active, .sm-clean ul a.highlighted, .sm-clean span.scroll-up, .sm-clean span.scroll-down, .sm-clean span.scroll-up:hover, .sm-clean span.scroll-down:hover { background-color:"+r.setAlpha(.4).toString()+";}",i+=".sm-clean ul { border: 1px solid "+r.setAlpha(.4).toString()+";}",i+=".sm-clean > li > ul:before, .sm-clean > li > ul:after { border-color: transparent transparent "+r.setAlpha(.4).toString()+" transparent;}",i+="}",document.getElementById("bgtfw-menu-colors")?document.getElementById("bgtfw-menu-colors").innerHTML=i:(o=document.head||document.getElementsByTagName("head")[0],(t=document.createElement("style")).type="text/css",t.id="bgtfw-menu-colors",t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),o.appendChild(t))})});new ToggleValue("header_container","#navi, #secondary-menu","container",w),new ToggleClass("bgtfw_fixed_header","body","header-fixed",w);let v=(e,t)=>(t.match(/(^|\s)layout-\S+/g)||[]).join(" ");new ToggleValue("bgtfw_footer_layouts","#colophon",v),new ToggleValue("bgtfw_header_top_layouts","#masthead",v,w),new Toggle("bgtfw_header_width",w),new Toggle("bgtfw_header_headings_color",()=>a("bgtfw_header_headings_color","#navi-wrap > :not(.bgtfw-widget-row)")),new Toggle("bgtfw_footer_headings_color",()=>a("bgtfw_footer_headings_color",".site-footer :not(.bgtfw-widget-row)")),new Toggle("blogname",t=>e(".site-title a").text(t)&&w()),new Toggle("blogdescription",t=>{e(".site-description").text(t).toggleClass("invisible",!t)&&w()}),new Toggle("boldgrid_background_vertical_position",c),new Toggle("boldgrid_background_horizontal_position",g),new Toggle("boldgrid_background_pattern",i),new Toggle("boldgrid_background_color",i),new Toggle("boldgrid_background_type",d),new Toggle("background_attachment",s),new Toggle("background_image",u),new Toggle("background_repeat",p),new Toggle("boldgrid_background_image_size",l),new ToggleValue("bgtfw_header_layout_position","body","header-top header-left header-right",e=>{"header-top"!==e&&parent.kirkiSetSettingValue.set("bgtfw_header_width",api("bgtfw_header_width")()),w()});e(document).on("customize-preview-menu-refreshed",function(t,o){e.each(o.newContainer.closest("[data-is-parent-column]"),function(){BOLDGRID.Customizer.Widgets.updatePartial(e(this)),"secondary-menu"===o.container_id&&""!==api("bgtfw_header_container")()&&document.getElementById(o.container_id).classList.add(api("bgtfw_header_container")())})}),api.selectiveRefresh.bind("partial-content-rendered",function(e){"boldgrid_header_widgets"!==e.partial.id&&"boldgrid_footer_widgets"!==e.partial.id||BOLDGRID.Customizer.Widgets.updatePartial(e.container),w()}),BOLDGRID.Customizer.Widgets.updatePartial=function(e){e.find(".comment-reply-link").addClass("btn button-primary color1-text-contrast").css("transition","all .5s"),e.find(".widget_rss ul").addClass("media-list"),e.find(".widget_meta ul, .widget_recent_entries ul, .widget_archive ul, .widget_categories ul, .widget_nav_menu ul, .widget_pages ul").addClass("nav"),e.find(".widget_recent_comments ul#recentcomments").css({"list-style":"none","padding-left":"0"}),e.find(".widget_recent_comments ul#recentcomments li").css("padding","5px 15px"),e.find('.sidebar select, select[name="archive-dropdown"]').addClass("form-control"),e.find(".sidebar .button").removeClass("button").addClass("btn button-primary"),e.find(".woocommerce.widget .ui-slider").css("display","none"),e.find(".woocommerce.widget .ui-slider").css("display","block"),e.find(".woocommerce.widget .ui-slider").addClass("color1-background-color").children().addClass("color2-background-color"),e.find(".button").removeClass("button").addClass("btn button-primary"),e.find(".button.alt").removeClass("button alt").addClass("btn button-secondary")},e(document).on("customize-preview-menu-refreshed",function(e,t){_.isUndefined(BoldGrid)||"main"===t.wpNavMenuArgs.theme_location&&(_.isUndefined(BoldGrid.standard_menu_enabled)||BoldGrid.standard_menu_enabled.init(t.newContainer))})})}(jQuery);