const $=jQuery,api=wp.customize;export class Devices{constructor(){this.devices={large:{name:"large",breakpoint:1200},desktop:{name:"desktop",breakpoint:992},tablet:{name:"tablet",breakpoint:768},mobile:{name:"mobile",breakpoint:0}},this.shouldChange=!0,this.currentDevice="",this.previewedDevice="",this.container=null,this.window=$(window),this.regex=/(^|\s)previewed-from-(?=desktop|mobile|large|tablet)\S+/g}init(){this._attachEvents()}_attachEvents(){this._customizerReady()}_customizerReady(){api.bind("ready",()=>this._previewerReady())}_previewerReady(){api.previewer.bind("ready",()=>{this.onLoad(),this._resize(),this._click()})}_resize(){$(window).on("resize",_.debounce(()=>{this.detectDevice(),this.setZoom(),this.previewedDevice===this.currentDevice&&(this.shouldChange=!0),this.shouldChange&&(this.toggleClass(this.currentDevice),this.setDevice(this.currentDevice,!1))},300))}_click(){$(".devices > button").on("click",(e,i)=>{(_.isUndefined(i)||!_.isUndefined(i.internal)&&!i.internal)&&(this.shouldChange=!1),this.previewedDevice=$(e.currentTarget).data("device"),wp.customize.previewer.preview.container.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",()=>this.setZoom()),this.setZoom(),this.detectDevice()})}onLoad(){this.previewedDevice?this.setZoom():(this.container=api.previewer.preview.container,this.detectDevice(),this.hasClass()||(this.toggleClass(this.currentDevice),this.setDevice(this.currentDevice,!1),$(".devices > button").blur(),this.shouldChange=!0))}setZoom(){let e=this.devices[this.currentDevice].breakpoint,i=this.devices[this.previewedDevice].breakpoint,t=api.previewer.preview.iframe[0];if(Object.assign(t.style,{width:"",height:"",msTransform:"",MozTransform:"",oTransform:"",webkitTransform:"",transform:"",msTransformOrigin:"",MozTransformOrigin:"",oTransformOrigin:"",webkitTransformOrigin:"",transformOrigin:""}),e<i){let e=t.offsetWidth,s=Math.abs(e/i),r="scale("+s.toString()+")",n="top left";Object.assign(t.style,{width:i+"px",height:Math.abs(parseInt(api.previewer.preview.iframe.outerHeight(!0))/s)+"px",msTransform:r,MozTransform:r,oTransform:r,webkitTransform:r,transform:r,msTransformOrigin:n,MozTransformOrigin:n,oTransformOrigin:n,webkitTransformOrigin:n,transformOrigin:n})}}detectDevice(){let e=window.innerWidth-$("#customize-controls").outerWidth();return this.devices.tablet.breakpoint>e?this.currentDevice=this.devices.mobile.name:this.devices.tablet.breakpoint<=e&&this.devices.desktop.breakpoint>=e?this.currentDevice=this.devices.tablet.name:this.devices.desktop.breakpoint<e&&this.devices.large.breakpoint>=e?this.currentDevice=this.devices.desktop.name:this.currentDevice=this.devices.large.name,_.isEmpty(this.previewedDevice)&&(this.previewedDevice=this.currentDevice),this.currentDevice}setDevice(e){let i=$(`.devices > [data-device="${e}"]`);$(".devices > button").blur(),i.trigger("click",[{internal:!0}]).blur()}toggleClass(e,i){this.removeClass(),this.container.addClass(`previewed-from-${e}`),document.body.className+=` bgtfw-is-${e}`,"function"==typeof i&&i()}removeClass(){document.body.className=document.body.className.replace(/(^|\s)bgtfw-is-(?=desktop|mobile|large|tablet)\S+/g,""),this.container.removeClass((e,i)=>(i.match(this.regex)||[]).join(" "))}hasClass(){return this.regex.test(this.container.attr("class"))}}