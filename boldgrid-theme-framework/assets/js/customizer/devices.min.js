const $=jQuery,api=wp.customize;export class Devices{constructor(){this.devices={large:{name:"large",breakpoint:1200},desktop:{name:"desktop",breakpoint:992},tablet:{name:"tablet",breakpoint:768},mobile:{name:"mobile",breakpoint:0}},this.shouldChange=!0,this.currentDevice="",this.previewedDevice="",this.container=null,this.window=$(window),this.regex=/(^|\s)previewed-from-(?=desktop|mobile|large|tablet)\S+/g}init(){this._attachEvents()}_attachEvents(){this._customizerReady()}_customizerReady(){api.bind("ready",()=>this._previewerReady())}_previewerReady(){api.previewer.bind("ready",()=>{this.onLoad(),this._resize(),this._click()})}_resize(){$(window).on("resize",_.debounce(()=>{this.detectDevice(),this.previewedDevice===this.currentDevice&&(this.shouldChange=!0),this.shouldChange&&(this.toggleClass(this.currentDevice),this.setDevice(this.currentDevice,!1))},300))}_click(){$(".devices > button").on("click",(e,t)=>{(_.isUndefined(t)||!_.isUndefined(t.internal)&&!t.internal)&&(this.shouldChange=!1),this.previewedDevice=$(e.currentTarget).data("device"),wp.customize.previewer.preview.container.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",()=>this.setBodyHeight()),this.detectDevice()})}onLoad(){this.container=api.previewer.preview.container,this.detectDevice(),this.hasClass()||(this.toggleClass(this.currentDevice),this.setDevice(this.currentDevice,!1),$(".devices > button").blur(),this.shouldChange=!0),this.setupScroll()}setupScroll(){let e=api.previewer.preview.iframe[0];e.seamless=!0,frames[e.name].document.body.style.overflow="hidden",this.setBodyHeight(),$(window).on("resize",_.debounce(()=>{this.setBodyHeight()},300)),$(window).on("scroll",()=>{let t=frames[e.name].document;t.documentElement.scrollTop=window.pageYOffset,t.body.scrollTop=window.pageYOffset,$(".wp-customizer .wp-full-overlay").scrollLeft(window.pageXOffset)}),$(frames[e.name]).on("scroll",()=>{window.document.scrollingElement.scrollTop=e.contentWindow.pageYOffset})}setBodyHeight(){let e=api.previewer.preview.iframe[0].name;document.body.style.height=frames[e].document.body.offsetHeight+"px";let t=frames[e].document.body.offsetWidth,i=document.getElementById("customize-controls").offsetWidth;document.body.style.width=Math.abs(t+i)+"px"}detectDevice(){let e=window.innerWidth-$("#customize-controls").outerWidth();return this.devices.tablet.breakpoint>e?this.currentDevice=this.devices.mobile.name:this.devices.tablet.breakpoint<=e&&this.devices.desktop.breakpoint>=e?this.currentDevice=this.devices.tablet.name:this.devices.desktop.breakpoint<e&&this.devices.large.breakpoint>=e?this.currentDevice=this.devices.desktop.name:this.currentDevice=this.devices.large.name,this.currentDevice}setDevice(e){let t=$(`.devices > [data-device="${e}"]`);$(".devices > button").blur(),t.trigger("click",[{internal:!0}]).blur()}toggleClass(e,t){this.removeClass(),this.container.addClass(`previewed-from-${e}`),document.body.className+=` bgtfw-is-${e}`,"function"==typeof t&&t()}removeClass(){document.body.className=document.body.className.replace(/(^|\s)bgtfw-is-(?=desktop|mobile|large|tablet)\S+/g,""),this.container.removeClass((e,t)=>(t.match(this.regex)||[]).join(" "))}hasClass(){return this.regex.test(this.container.attr("class"))}}