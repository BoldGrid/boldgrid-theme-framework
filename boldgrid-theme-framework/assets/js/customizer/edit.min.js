var BOLDGRID=BOLDGRID||{};BOLDGRID.Customizer_Edit=function(t){var i=this,o=parent.wp.customize;i.buttonCollisionSet=1,i.animatingEmptyParent=!1,i.targetHighlightTop=!0,i.userIsScrolling=!1,i.buttonHeight=0,this.addButtons=function(){var n,a={blogname:".site-title a",boldgrid_logo_setting:".logo-site-title",boldgrid_enable_footer:".attribution","entry-content":".entry-content","entry-title":".entry-title",blogdescription:".site-description"},e=_.keys(a),s=o.section("menu_locations").controls(),r=t(".empty-menu"),l=t("[data-empty-area=\"'true'\"]");_(e).each(function(t){i.addButton(null,t,a[t])}),t("aside.widget").each(function(){var o=t(this).attr("id");i.addButton("sidebar",o,"#"+o)}),t('aside[id^="black-studio-tinymce-"').each(function(){var o=t(this),n=o.attr("id"),a=n.replace("black-studio-tinymce-","").trim();i.addButton("widget_black-studio-tinymce",a,"#"+n)}),_(s).each(function(o){n=t("."+o.themeLocation.replace(/_/g,"-")+"-menu").find("ul").first().attr("id"),void 0!==n&&i.addButton("nav_menu",o.setting._value,"#"+n)}),_(r).each(function(o){i.addButton(null,"new_menu_name","#"+t(o).attr("id"))}),_(l).each(function(o){t(o).append('<div class="empty-area"></div>');var n=t(o).attr("data-widget-area"),a=n.replace("accordion-section-sidebar-widgets-",""),e="[data-widget-area='"+n+"']";i.addButton("sidebars_widgets",a,e)})},this.bottomInView=function(i){var o=t(window),n=o.scrollTop(),a=n+o.height(),e=i.offset().top,s=e+i.height();return s>n&&a>s},this.buttonClick=function(i){var n,a,e=i.attr("data-control"),s=parent.window._wpCustomizeControlsL10n.cancel,r={width:400,resizable:!1,modal:!0},l=boldgridFrameworkCustomizerEdit.goThereNow,d=t(i.attr("data-selector"));return r.buttons={},r.buttons[l]=function(){parent.window.location=boldgridFrameworkCustomizerEdit.editPostLink},r.buttons[s]=function(){t(this).dialog("close")},"entry-content"===e||"entry-title"===e?void t("#"+e).dialog(r):(0===e.lastIndexOf("sidebars_widgets",0)?o.control(e).focus():0===e.lastIndexOf("sidebar",0)?(a=e.match(/\[(.*?)\]/),o.Widgets.focusWidgetFormControl(a[1])):"new_menu_name"===e?(n=d.attr("data-theme-location"),o.control("nav_menu_locations["+n+"]").focus()):o.control(e).focus(),void setTimeout(function(){var i,n=t(":focus",parent.document);"boldgrid_enable_footer"===e&&(n=t(o.control(e).selector,parent.document)),0===e.lastIndexOf("nav_menu",0)&&(n=t(".customize-control-nav_menu_name",parent.document)),e.startsWith("sidebar[")&&(n=n.closest(".widget")),i=n.css("transition"),n.css({"min-height":n.outerHeight(),"min-width":n.outerWidth(),transition:"all 0s"}).effect("bounce",{times:3,distance:10},"slow",function(){t(this).css("transition",i)})},500))},this.buttonMouseEnter=function(o,n,a){var e,s=n.offset().top,r=a.offset(),l=n.outerHeight();0===l&&n.find("*").each(function(){var i=t(this).outerHeight();i>l&&(l=i)}),"1"===o.attr("data-fixed-ancestor")?(i.$targetHighlight.css("position","fixed"),s=n.offset().top-t(window).scrollTop()):i.$targetHighlight.css("position","absolute"),i.$targetHighlight.stop(!0).css("width",a.outerWidth()).css("height",l).css("top",s).css("left",r.left).css("visibility","visible");var d=0;i.targetHighlightTop=setInterval(function(){d+=10,i.$targetHighlight.css("top",n.offset().top),d>=400&&clearInterval(i.targetHighlightTop)},10),o.hasClass("new")&&(e=parseInt(o.attr("data-with-title-width")),o.stop(!0).html(" "+o.attr("data-title")).animate({"max-width":e+"px",left:i.right(o)-e},400)),i.isParentEmpty(n)&&(n.stop(!0).animate({height:i.buttonHeight},400),i.$targetHighlight.stop(!0).css("visibility","visible").animate({height:i.buttonHeight},400))},this.buttonMouseLeave=function(t,o){t.hasClass("new")&&t.stop(!0).animate({"max-width":30,left:t.attr("data-left")},400,function(){t.html("")}),clearInterval(i.targetHighlightTop),i.isParentEmpty(o)?(o.stop(!0).animate({height:"0px"},500),i.$targetHighlight.height()<=2?i.$targetHighlight.css("visibility","hidden"):i.$targetHighlight.stop(!0).animate({height:"0px"},400,function(){i.$targetHighlight.css("visibility","hidden")})):i.$targetHighlight.css("visibility","hidden")},this.collide=function(t,i){var o=parseInt(t.attr("data-left")),n=parseInt(t.attr("data-top")),a=t.outerHeight(!0),e=t.outerWidth(!0),s=n+a,r=o+e,l=parseInt(i.attr("data-left")),d=parseInt(i.attr("data-top")),u=i.outerHeight(!0),c=i.outerWidth(!0),h=d+u,p=l+c;return!(d>s||n>h||l>r||o>p)},this.findCollision=function(){var o=[],n=t("div:visible").not("#target-highlight").last(),a=n.offset().top+n.outerHeight(!0);i.buttonCollisionSet=1,t("button[data-control]:visible").each(function(){o.push(t(this))}),o.sort(i.sortButtons),t.each(o,function(n,a){n<o.length-1&&($buttonA=t(a),t.each(o,function(o,n){$buttonB=t(n),$buttonA.is($buttonB)||i.collide($buttonA,$buttonB)&&i.fixCollision($buttonA,$buttonB)}))}),o.sort(i.sortButtonsDesc),_(o).each(function(i,o){$button=t(i);var n=parseInt($button.attr("data-top"))+$button.outerHeight(!0);if(n>a){var e=n-a,s=t(i).attr("data-collision-set");"undefined"!=typeof s&&t.each(t("[data-collision-set="+s+"]"),function(){$buttonInSet=t(this);var i=parseInt($buttonInSet.attr("data-top")-e);$buttonInSet.attr("data-top",i)})}})},this.fixButtonPlacement=function(){var o='[data-control][style*="position: fixed"][data-fixed-ancestor="0"]:not(.highlight-button)';t(o).each(function(){var o=t(this);t(o.attr("data-selector")),o.attr("data-control");o.css("position","absolute").css("top",t(window).scrollTop()),i.placeButton(o),i.findCollision()})},this.fixCollision=function(t,o){var n=parseInt(t.attr("data-top")),a=parseInt(o.attr("data-top")),e=n>a?t:o,s=t.is(e)?o:t;e.attr("data-top",parseInt(s.attr("data-top"))+i.buttonHeight);var r=s.attr("data-collision-set");"undefined"==typeof r&&(r=i.buttonCollisionSet,i.buttonCollisionSet++),e.attr("data-collision-set",r),s.attr("data-collision-set",r)},this.getFixedAncestors=function(i){var o=i.parents().filter(function(){return"fixed"===t(this).css("position")});return o},this.init=function(){i.$targetHighlight=t("#target-highlight"),i.addButtons(),i.buttonHeight=t("button[data-control]:visible").first().outerHeight(),i.placeButtons(),t(window).resize(function(){clearTimeout(t.data(this,"resizeTimer")),t.data(this,"resizeTimer",setTimeout(function(){i.placeButtons()},400))}),t(".navbar-toggle").click(function(){setTimeout(i.placeButtons,400)}),t(window).scroll(function(){i.userIsScrolling=!0,clearTimeout(t.data(this,"scrollTimer")),t.data(this,"scrollTimer",setTimeout(function(){i.userIsScrolling=!1,i.windowScroll()},100))}),wp.customize.preview.bind("setting",function(o){clearTimeout(t.data(this,"previewBind")),t.data(this,"previewBind",setTimeout(function(){i.placeButtons()},400))})},this.inView=function(i){var o=t(window),n=o.scrollTop(),a=n+o.height(),e=i.offset().top,s=e+i.height();return a>=e&&s>=n},this.isParentEmpty=function(t){return t.hasClass("empty-menu")||"'true'"===t.attr("data-empty-area")},this.parentColumn=function(t){var i=null,o=!1,n=["div[class*=col-]","div[class^=row]","div[class^=container]","div","p"];return _(n).each(function(n){!1===o&&(i=t.closest(n),i.length>0&&(o=!0))}),i},this.placeButton=function(o){var n,a,e=t(o.attr("data-selector")),s=e.offset(),r=i.parentColumn(e),l=parseInt(o.attr("data-moves")),d=0===l?0:400,u=i.getFixedAncestors(e),c=u.length>0?"1":"0";if(o.attr("data-fixed-ancestor",c),u.length?(a=parseInt(u.last().css("z-index")),Number.isInteger(a)&&o.css("z-index",a+1)):o.css("z-index",""),e.hasClass("hidden")||e.hasClass("invisible")||!e.is(":visible"))return void(0===l?o.hide():o.fadeOut());o.fadeIn(),n=i.right(r),i.right(r)+o.outerWidth(!0)>t("body").outerWidth(!0)&&(n=t("body").outerWidth(!0)-o.outerWidth(!0));var h="absolute",p=s.top;"1"===o.attr("data-fixed-ancestor")&&(h="fixed",p=s.top-t(window).scrollTop()),l++,o.attr("data-last-animation","placeButton").attr("data-moves",l).css("position",h).attr("data-top",p).attr("data-left",n).attr("data-duration",d).removeAttr("data-collision-set")},this.placeButtons=function(){t("button[data-control]").each(function(){$button=t(this),i.placeButton($button)}),i.findCollision(),i.positionByData()},i.positionByData=function(){t("button[data-control]").each(function(){$button=t(this),$button.hasClass("highlight-button")&&"fixed"===$button.css("position")||$button.hasClass("new")&&$button.is(":animated")||$button.attr("data-last-animation","positionByData").animate({top:parseInt($button.attr("data-top")),left:parseInt($button.attr("data-left"))},parseInt($button.attr("data-duration")))})},i.positionHighlighted=function(o,n){o=null===o?t(".highlight-button"):o,1===o.length&&(i.topInView(n)||"fixed"===o.css("position")||o.css("position","fixed").css("top",-1*o.outerHeight()).animate({top:"0px"},400))},this.right=function(t){return t.offset().left+t.outerWidth()},this.sortButtons=function(o,n){if(aTop=o.offset().top,bTop=n.offset().top,aTop===bTop){$parentA=t(o.attr("data-selector"));var a=$parentA.offset().top;i.isParentEmpty($parentA)&&(a-=1),aTop=a,$parentB=t(n.attr("data-selector"));var e=$parentB.offset().top;i.isParentEmpty($parentB)&&(e-=1),bTop=e}return aTop<bTop?-1:aTop>bTop?1:0},this.sortButtonsDesc=function(t,i){return aTop=t.offset().top,bTop=i.offset().top,bTop<aTop?-1:bTop>aTop?1:0},this.topInView=function(i){var o=t(window),n=o.scrollTop(),a=n+o.height(),e=i.offset().top;e+i.height();return 0===n&&0>e?!0:e>=n&&a>=e},this.windowScroll=function(){var o='[data-control][style*="position: fixed"][data-fixed-ancestor="0"]:not(.highlight-button)';t(o).each(function(){var o=t(this),n=t(o.attr("data-selector"));o.attr("data-control");o.css("position","absolute").css("top",t(window).scrollTop()),i.topInView(n)?(i.placeButton(o),i.findCollision(),i.positionByData()):o.attr("data-last-animation","animation-c").animate({top:"-="+i.buttonHeight},400,function(){i.placeButton(o),i.findCollision(),i.positionByData()})});var n,a=t('.highlight-button[data-control][data-fixed-ancestor="0"]');if(1===a.length){if(n=t(a.attr("data-selector")),buttonIsFixed="fixed"===a.css("position"),i.topInView(n)&&buttonIsFixed)return a.attr("data-last-animation","animation-b").css("position","absolute").css("top",t(window).scrollTop()),i.placeButton(a),i.findCollision(),void i.positionByData();if(!i.topInView(n)&&!buttonIsFixed)return void a.stop(!0).attr("data-last-animation","animation-a").css("position","fixed").css("top",-1*a.outerHeight()).animate({top:"0px"},400);if(!i.inView(n)&&buttonIsFixed)return void a.animate({top:"-="+i.buttonHeight},400,function(){i.placeButton(a),i.findCollision(),i.positionByData()})}},this.addButton=function(o,n,a){var e=t("<button></button>"),s=t(a),r=i.parentColumn(s),l=null===o?n:o+"["+n+"]",d=i.getFixedAncestors(s),u=d.length>0?"1":"0",c="'true'"===s.attr("data-empty-area"),h=s.hasClass("empty-menu");0===t("body").find('[data-selector="'+a+'"]').length&&(h&&e.addClass("new").attr("data-title",boldgridFrameworkCustomizerEdit.menu),c&&e.addClass("new").attr("data-title",boldgridFrameworkCustomizerEdit.widget),e.attr("data-control",l).attr("data-selector",a).attr("data-moves",0).attr("data-fixed-ancestor",u),t("body").append(e),(h||c)&&e.css("max-width","100%").html(" "+e.attr("data-title")).attr("data-with-title-width",e.outerWidth(!0)).css("max-width","").html(""),e.hover(function(){i.buttonMouseEnter(e,s,r)},function(){i.buttonMouseLeave(e,s)}),e.on("click",function(){i.buttonClick(e)}),s.hover(function(){e.addClass("highlight-button"),i.topInView(s)||"fixed"===e.css("position")||!1!==i.userIsScrolling||e.attr("data-last-animation","ancar").css("position","fixed").css("top",-1*e.outerHeight()).animate({top:"0px"},400)},function(){e.removeClass("highlight-button")}))},t(window).load(function(){i.init(),setTimeout(function(){i.placeButtons()},3e3)})},new BOLDGRID.Customizer_Edit(jQuery);