var BOLDGRID=BOLDGRID||{};BOLDGRID.Customizer_Edit=function(t){var e=this,o=parent.wp.customize;t(function(){setTimeout(e.init,500)}),this.addButtons=function(){var i,n={blogname:".site-title a",boldgrid_logo_setting:".logo-site-title",boldgrid_enable_footer:".attribution","entry-content":".entry-content","entry-title":".entry-title",blogdescription:".site-description"},a=_.keys(n),s=o.section("menu_locations").controls(),r=t(".empty-menu"),c=t("[data-empty-area=\"'true'\"]");_(a).each(function(t){e.addButton(null,t,n[t])}),t("aside.widget").each(function(){var o=t(this).attr("id");e.addButton("sidebar",o,"#"+o)}),t('aside[id^="black-studio-tinymce-"').each(function(){var o=t(this),i=o.attr("id"),n=i.replace("black-studio-tinymce-","").trim();e.addButton("widget_black-studio-tinymce",n,"#"+i)}),_(s).each(function(o){i=t("."+o.themeLocation.replace(/_/g,"-")+"-menu").find("ul").first().attr("id"),void 0!==i&&e.addButton("nav_menu",o.setting._value,"#"+i)}),_(r).each(function(o){e.addButton(null,"new_menu_name","#"+t(o).attr("id"))}),_(c).each(function(o){t(o).append('<p style="color:#fff;background-color:blue;">Add a widget</p>');var i=t(o).attr("data-widget-area"),n=i.replace("accordion-section-sidebar-widgets-",""),a="[data-widget-area='"+i+"']";e.addButton("sidebars_widgets",n,a)})},this.buttonClick=function(e){var i=e.attr("data-control"),n=parent.window._wpCustomizeControlsL10n.cancel,a={width:400,resizable:!1,modal:!0},s=boldgridFrameworkCustomizerEdit.goThereNow;if(a.buttons={},a.buttons[s]=function(){parent.window.location=boldgridFrameworkCustomizerEdit.editPostLink},a.buttons[n]=function(){t(this).dialog("close")},"entry-content"===i||"entry-title"===i)return void t("#"+i).dialog(a);if(0===i.lastIndexOf("sidebars_widgets",0))o.control(i).focus();else if(0===i.lastIndexOf("sidebar",0)){var r=i.match(/\[(.*?)\]/);o.Widgets.focusWidgetFormControl(r[1])}else"new_menu_name"===i?o.panel("nav_menus").expand():o.control(i).focus();setTimeout(function(){var e,n=t(":focus",parent.document);"boldgrid_enable_footer"===i&&(n=t(o.control(i).selector,parent.document)),0===i.lastIndexOf("nav_menu",0)&&(n=t(".customize-control-nav_menu_name",parent.document)),i.startsWith("sidebar[")&&(n=n.closest(".widget")),"new_menu_name"===i&&(n=t(".add-menu-toggle",parent.document)),e=n.css("transition"),n.css({"min-height":n.outerHeight(),"min-width":n.outerWidth(),transition:"all 0s"}).effect("bounce",{times:3,distance:10},"slow",function(){t(this).css("transition",e)})},500)},this.buttonMouseEnter=function(o,i,n){var a=i.offset().top,s=n.offset(),r=i.outerHeight();0===r&&i.find("*").each(function(){var e=t(this).outerHeight();e>r&&(r=e)}),"1"===o.attr("data-fixed-ancestor")?(e.$targetHighlight.css("position","fixed"),a=i.offset().top-t(window).scrollTop()):e.$targetHighlight.css("position","absolute"),e.$targetHighlight.css("width",n.outerWidth()).css("height",r).css("top",a).css("left",s.left).css("visibility","visible")},this.buttonMouseLeave=function(t){e.$targetHighlight.css("visibility","hidden")},this.fixButtonPlacement=function(){var o='[data-control][style*="position: fixed"][data-fixed-ancestor="0"]:not(.highlight-button)';t(o).each(function(){var o=t(this);t(o.attr("data-selector")),o.attr("data-control");o.css("position","absolute").css("top",t(window).scrollTop()),e.placeButton(o)})},this.getFixedAncestors=function(e){var o=e.parents().filter(function(){return"fixed"===t(this).css("position")});return o},this.init=function(){e.$targetHighlight=t("#target-highlight"),e.addButtons(),e.placeButtons(),setTimeout(function(){e.placeButton(t("button[data-control=boldgrid_enable_footer]"))},1e3),t(window).resize(function(){clearTimeout(t.data(this,"resizeTimer")),t.data(this,"resizeTimer",setTimeout(function(){e.placeButtons()},400))}),t(".navbar-toggle").click(function(){setTimeout(e.placeButtons,400)}),t(window).scroll(function(){clearTimeout(t.data(this,"scrollTimer")),t.data(this,"scrollTimer",setTimeout(function(){e.windowScroll(),e.fixButtonPlacement()},100))}),wp.customize.preview.bind("setting",function(o){clearTimeout(t.data(this,"previewBind")),t.data(this,"previewBind",setTimeout(function(){e.placeButtons()},400))})},this.parentColumn=function(t){var e=null,o=!1,i=["div[class*=col-]","div[class^=row]","div[class^=container]","div","p"];return _(i).each(function(i){!1===o&&(e=t.closest(i),e.length>0&&(o=!0))}),e},this.placeButton=function(o){var i,n=t(o.attr("data-selector")),a=n.offset(),s=e.parentColumn(n),r=parseInt(o.attr("data-moves")),c=0===r?0:400,d=e.getFixedAncestors(n),u=d.length>0?"1":"0";if(o.attr("data-fixed-ancestor",u),n.hasClass("hidden")||!n.is(":visible"))return void(0===r?o.hide():o.fadeOut());o.fadeIn(),i=e.right(s),e.right(s)+o.outerWidth(!0)>t("body").outerWidth(!0)&&(i=t("body").outerWidth(!0)-o.outerWidth(!0));var l="absolute",h=a.top;"1"===o.attr("data-fixed-ancestor")&&(l="fixed",h=a.top-t(window).scrollTop()),r++,o.attr("data-moves",r).css("position",l).animate({top:h,left:i},c)},this.placeButtons=function(){t("button[data-control]").each(function(){$button=t(this),e.placeButton($button)})},this.right=function(t){return t.offset().left+t.outerWidth()},this.topInView=function(e){var o=t(window),i=o.scrollTop(),n=i+o.height(),a=e.offset().top;a+e.height();return 0===i&&0>a?!0:a>=i&&n>=a},this.windowScroll=function(){var o,i=t(".highlight-button");1===i.length&&"1"!==i.attr("data-fixed-ancestor")&&(o=t(i.attr("data-selector")),e.topInView(o)?"fixed"===i.css("position")&&i.css("position","absolute").css("top",t(window).scrollTop()).animate({top:o.offset().top},400):"absolute"===i.css("position")&&i.css("position","fixed").css("top",-1*i.outerHeight()).animate({top:"0px"},400))},this.addButton=function(o,i,n){var a=t("<button></button>"),s=t(n),r=e.parentColumn(s),c=null===o?i:o+"["+i+"]",d=e.getFixedAncestors(s),u=d.length>0?"1":"0";0===t("body").find('[data-selector="'+n+'"]').length&&(a.attr("data-control",c).attr("data-selector",n).attr("data-moves",0).attr("data-fixed-ancestor",u),t("body").append(a),a.hover(function(){e.buttonMouseEnter(a,s,r)},function(){e.buttonMouseLeave(r)}),a.on("click",function(){e.buttonClick(a)}),s.hover(function(){a.addClass("highlight-button"),e.windowScroll()},function(){a.removeClass("highlight-button")}))}},new BOLDGRID.Customizer_Edit(jQuery);