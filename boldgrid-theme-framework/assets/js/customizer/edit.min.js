var BOLDGRID=BOLDGRID||{};BOLDGRID.Customizer_Edit=function(t){var o=this,i=parent.wp.customize;t(function(){setTimeout(o.init,500)}),this.addButtons=function(){var e,n={blogname:".site-title a",boldgrid_logo_setting:".logo-site-title",boldgrid_enable_footer:".attribution","entry-content":".entry-content","entry-title":".entry-title",blogdescription:".site-description"},s=_.keys(n),a=i.section("menu_locations").controls();_(s).each(function(t){o.addButton(null,t,n[t])}),t("aside.widget").each(function(){var i=t(this).attr("id");o.addButton("sidebar",i,"#"+i)}),t('aside[id^="black-studio-tinymce-"').each(function(){var i=t(this),e=i.attr("id"),n=e.replace("black-studio-tinymce-","").trim();o.addButton("widget_black-studio-tinymce",n,"#"+e)}),_(a).each(function(i){e=t("."+i.themeLocation.replace(/_/g,"-")+"-menu").find("ul").first().attr("id"),void 0!==e&&o.addButton("nav_menu",i.setting._value,"#"+e)})},this.buttonClick=function(o){var e=o.attr("data-control"),n=parent.window._wpCustomizeControlsL10n.cancel,s={width:400,resizable:!1,modal:!0},a=boldgridFrameworkCustomizerEdit.goThereNow;if(s.buttons={},s.buttons[a]=function(){parent.window.location=boldgridFrameworkCustomizerEdit.editPostLink},s.buttons[n]=function(){t(this).dialog("close")},"entry-content"==e||"entry-title"==e)return void t("#"+e).dialog(s);if(0===e.lastIndexOf("sidebar",0)){var r=e.match(/\[(.*?)\]/);i.Widgets.focusWidgetFormControl(r[1])}else i.control(e).focus();setTimeout(function(){var o=t(":focus",parent.document);"boldgrid_enable_footer"===e&&(o=t(i.control(e).selector,parent.document)),0===e.lastIndexOf("nav_menu",0)&&(o=t(".customize-control-nav_menu_name",parent.document)),e.startsWith("sidebar[")&&(o=o.closest(".widget")),o.css({"min-height":o.outerHeight(),"min-width":o.outerWidth()}).effect("bounce",{times:3,distance:10},"slow")},500)},this.buttonMouseEnter=function(i,e,n){var s=e.offset().top,a=n.offset(),r=e.outerHeight();0===r&&e.find("*").each(function(){var o=t(this).outerHeight();o>r&&(r=o)}),"1"===i.attr("data-fixed-ancestor")?(o.$targetHighlight.css("position","fixed"),s=e.offset().top-t(window).scrollTop()):o.$targetHighlight.css("position","absolute"),o.$targetHighlight.css("width",n.outerWidth()).css("height",r).css("top",s).css("left",a.left).css("visibility","visible")},this.buttonMouseLeave=function(t){o.$targetHighlight.css("visibility","hidden")},this.fixButtonPlacement=function(){var i='[data-control][style*="position: fixed"][data-fixed-ancestor="0"]:not(.highlight-button)';t(i).each(function(){var i=t(this);t(i.attr("data-selector")),i.attr("data-control");i.css("position","absolute").css("top",t(window).scrollTop()),o.placeButton(i)})},this.getFixedAncestors=function(o){var i=o.parents().filter(function(){return"fixed"===t(this).css("position")});return i},this.init=function(){o.$targetHighlight=t("#target-highlight"),o.addButtons(),o.placeButtons(),setTimeout(function(){o.placeButton(t("button[data-control=boldgrid_enable_footer]"))},1e3),t(window).resize(function(){clearTimeout(t.data(this,"resizeTimer")),t.data(this,"resizeTimer",setTimeout(function(){o.placeButtons()},400))}),t(".navbar-toggle").click(function(){setTimeout(o.placeButtons,400)}),t(window).scroll(function(){clearTimeout(t.data(this,"scrollTimer")),t.data(this,"scrollTimer",setTimeout(function(){o.windowScroll(),o.fixButtonPlacement()},100))}),wp.customize.preview.bind("setting",function(i){clearTimeout(t.data(this,"previewBind")),t.data(this,"previewBind",setTimeout(function(){o.placeButtons()},400))})},this.parentColumn=function(t){var o=null,i=!1,e=["div[class*=col-]","div[class^=row]","div[class^=container]","div","p"];return _(e).each(function(e){!1===i&&(o=t.closest(e),o.length>0&&(i=!0))}),o},this.placeButton=function(i){var e,n=t(i.attr("data-selector")),s=n.offset(),a=o.parentColumn(n),r=parseInt(i.attr("data-moves")),c=0===r?0:400,d=o.getFixedAncestors(n),u=d.length>0?"1":"0";if(i.attr("data-fixed-ancestor",u),n.hasClass("hidden")||!n.is(":visible"))return void(0===r?i.hide():i.fadeOut());i.fadeIn(),e=o.right(a),o.right(a)+i.outerWidth(!0)>t("body").outerWidth(!0)&&(e=t("body").outerWidth(!0)-i.outerWidth(!0));var l="absolute",h=s.top;"1"===i.attr("data-fixed-ancestor")&&(l="fixed",h=s.top-t(window).scrollTop()),r++,i.attr("data-moves",r).css("position",l).animate({top:h,left:e},c)},this.placeButtons=function(){t("button[data-control]").each(function(){$button=t(this),o.placeButton($button)})},this.right=function(t){return t.offset().left+t.outerWidth()},this.topInView=function(o){var i=t(window),e=i.scrollTop(),n=e+i.height(),s=o.offset().top;s+o.height();return 0===e&&0>s?!0:s>=e&&n>=s},this.windowScroll=function(){var i,e=t(".highlight-button");1===e.length&&"1"!==e.attr("data-fixed-ancestor")&&(i=t(e.attr("data-selector")),o.topInView(i)?"fixed"===e.css("position")&&e.css("position","absolute").css("top",t(window).scrollTop()).animate({top:i.offset().top},400):"absolute"===e.css("position")&&e.css("position","fixed").css("top",-1*e.outerHeight()).animate({top:"0px"},400))},this.addButton=function(i,e,n){var s=t("<button></button>"),a=t(n),r=o.parentColumn(a),c=null===i?e:i+"["+e+"]",d=o.getFixedAncestors(a),u=d.length>0?"1":"0";0===t("body").find('[data-selector="'+n+'"]').length&&(s.attr("data-control",c).attr("data-selector",n).attr("data-moves",0).attr("data-fixed-ancestor",u),t("body").append(s),s.hover(function(){o.buttonMouseEnter(s,a,r)},function(){o.buttonMouseLeave(r)}),s.on("click",function(){o.buttonClick(s)}),a.hover(function(){s.addClass("highlight-button"),o.windowScroll()},function(){s.removeClass("highlight-button")}))}},new BOLDGRID.Customizer_Edit(jQuery);