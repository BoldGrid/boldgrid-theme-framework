import{BorderRadius}from"@boldgrid/controls/src/controls/border-radius";import{Margin}from"@boldgrid/controls/src/controls/margin";import{Padding}from"@boldgrid/controls/src/controls/padding";import{BoxShadow}from"@boldgrid/controls/src/controls/box-shadow";import{Control as DeviceVisibility}from"@boldgrid/controls/src/controls/device-visibility";import{Border}from"./border";import{DevicePreview}from"./device-preview";import{MultiSlider}from"@boldgrid/controls/src/controls/multi-slider";import"../../../scss/customizer/controls/_generic.scss";export class Control{constructor(){this.classes={BorderRadius:BorderRadius,DeviceVisibility:DeviceVisibility,BoxShadow:BoxShadow,MultiSlider:MultiSlider,Border:Border,Padding:Padding,Margin:Margin}}init(){return $(()=>{this.devicePreview=new DevicePreview,this._bindConfigs()}),this}_bindConfigs(){wp.customize.control.each(e=>{e.params.choices&&"boldgrid_controls"===e.params.choices.name&&this._setupControl(e)})}_setupControl(e){let i,t=e.params.choices.settings||{};this._setDefaults(e,t),this._setSavedValues(e,t),i=new this.classes[e.params.choices.type](t,e),this._bindRender(e,i),this._bindChangeEvent(e,i)}_setDefaults(e,i){const t=e.params.default;t&&("DeviceVisibility"===e.params.choices.type?i.control.setting=t:i.defaults=t)}_setSavedValues(e,i){let t=e.setting.get()||!1;if(_.isObject(t)&&t.media){i.saved=t;try{i.saved.media=JSON.parse(i.saved.media)||{}}catch(e){i.saved.media={}}}}_bindRender(e,i){e.deferred.embedded.done(()=>{setTimeout(()=>{const t=$(e.selector).find("label");t.after(i.render()),t.replaceWith($('<input type="text">').hide()),this._bindDeleteEvent(e,i),this.devicePreview.setupControl(i)})})}_bindChangeEvent(e,i){let t=_.throttle(i=>{let t={...i};t.media=JSON.stringify(t.media),e.setting.set(t)},50);i.events.on("change",t)}_bindDeleteEvent(e,i){i.events.on("deleteSettings",()=>e.setting.set(null))}}