import{Preview as PreviewUtility}from"../preview";import PaletteSelector from"../color/palette-selector";const api=wp.customize,$=jQuery,colorLib=window.net.brehaut;export class LinkPreview{constructor(){this.previewUtility=new PreviewUtility,this.paletteSelector=new PaletteSelector,this.prefixes=["bgtfw_body","bgtfw_posts_date"],this.selectors={}}bindEvents(){$(()=>{let t=this.prefixes;for(let e of t)this.selectors[e]=this.getSelectors(e),api(`${e}_link_color_display`,`${e}_link_color`,`${e}_link_color_hover`,`${e}_link_decoration`,`${e}_link_decoration_hover`,(...t)=>{t.map(t=>{t.bind(()=>this.updateStyles(e))})})})}getSelectors(t){let e=[];return parent.wp.customize.control&&parent.wp.customize.control(`${t}_link_color`)&&(e=parent.wp.customize.control(`${t}_link_color`).params.choices.selectors),e}updateStyles(t){let e="";if(!api(`${t}_link_color_display`)||"inherit"!==api(`${t}_link_color_display`)()){let o,i=this._getColor(`${t}_link_color`),r=api(`${t}_link_color_hover`)()||0,l=this._getDecoration(`${t}_link_decoration`),n=this._getDecoration(`${t}_link_decoration_hover`),c="",s=this.selectors[t];r=parseInt(r,10)/100,o=colorLib.Color(i).lightenByAmount(r).toCSS();for(let t of s)e+=`\n\t\t\t\t\t${t+=c} {\n\t\t\t\t\t\tcolor: ${i};\n\t\t\t\t\t\ttext-decoration: ${l};\n\t\t\t\t\t}\n\t\t\t\t\t${t}:hover,\n\t\t\t\t\t${t}:focus {\n\t\t\t\t\t\tcolor: ${o};\n\t\t\t\t\t\ttext-decoration: ${n};\n\t\t\t\t\t}\n\t\t\t\t`}let o=t.replace(/_/g,"-");this.previewUtility.updateDynamicStyles(`${o}-link-inline-css`,e)}_getDecoration(t){return api(t)()}_getColor(t){let e=api(t)()||"";return this.paletteSelector.getColor(e)}}