import{Preview as PreviewUtility}from"../preview";import PaletteSelector from"../color/palette-selector";const api=wp.customize,colorLib=window.net.brehaut;export class LinkPreview{constructor(){this.previewUtility=new PreviewUtility,this.paletteSelector=new PaletteSelector,this.prefixes=["bgtfw_body","bgtfw_posts_date","bgtfw_posts_byline","bgtfw_posts_tags","bgtfw_posts_cats","bgtfw_posts_navigation","bgtfw_blog_post_header_byline","bgtfw_blog_post_header_date","bgtfw_blog_post_cats","bgtfw_blog_post_tags","bgtfw_blog_post_comments","bgtfw_blog_post_readmore"],this.selectors={}}bindEvents(){$(()=>{let t=this.prefixes;for(let e of t){this.selectors[e]=this.getSelectors(e);let t=[`${e}_link_color`,`${e}_link_color_hover`,`${e}_link_decoration`,`${e}_link_decoration_hover`];"bgtfw_body"!==e&&t.push(`${e}_link_color_display`),api(...t,(...t)=>{t.map(t=>t.bind(()=>this.updateStyles(e)))})}})}getSelectors(t){let e=[];return parent.wp.customize.control&&parent.wp.customize.control(`${t}_link_color`)&&(e=parent.wp.customize.control(`${t}_link_color`).params.choices.selectors),e}updateStyles(t){let e="";if(!1===_.isFunction(api(`${t}_link_color_display`))||"inherit"!==api(`${t}_link_color_display`)()){let o,i=this._getColor(`${t}_link_color`),l=api(`${t}_link_color_hover`)()||0,r=this._getDecoration(`${t}_link_decoration`),s=this._getDecoration(`${t}_link_decoration_hover`),_="",n=this.selectors[t];l=parseInt(l,10)/100,o=colorLib.Color(i).lightenByAmount(l).toCSS();for(let t of n)e+=`\n\t\t\t\t\t${t+=_} {\n\t\t\t\t\t\tcolor: ${i};\n\t\t\t\t\t\ttext-decoration: ${r};\n\t\t\t\t\t}\n\t\t\t\t\t${t}:hover,\n\t\t\t\t\t${t}:focus {\n\t\t\t\t\t\tcolor: ${o};\n\t\t\t\t\t\ttext-decoration: ${s};\n\t\t\t\t\t}\n\t\t\t\t`}let o=t.replace(/_/g,"-");this.previewUtility.updateDynamicStyles(`${o}-link-inline-css`,e)}_getDecoration(t){return api(t)()}_getColor(t){let e=api(t)()||"";return this.paletteSelector.getColor(e)}}